import{r as p,j as e,a as Jt}from"./react-cNyXNeAR.js";import{c as Xt}from"./react-dom-BVY8cs61.js";import{L as ae,B as Qt}from"./react-router-dom-BShEGWT2.js";import{a as z,d as X,b as st,O as ot,e as nt,f as it,g as F}from"./react-router-C0Du2Cgo.js";import{P as Zt,S as er}from"./pdf-lib-DhSRzJf_.js";import{F as _,a as G,b as v,u as lt,E as Se,c as tr,d as Le}from"./formik-CiAmmF0S.js";import{h as se}from"./moment-C5S46NFB.js";import{c as K,a as I,b as J,d as Z,e as Te,f as rr,g as Fe}from"./yup-CBsLbAo2.js";import{_ as R,I as ce}from"./react-hot-toast-K9wR0Yv9.js";/* empty css                  */import{d as ar,a as sr,b as or,c as nr,e as ir,f as lr,g as cr,h as dr,i as mr,I as ct,j as A,k as dt,l as mt,B as f,m as pt,n as ht,o as ut,p as xt,q as ft,r as jt,s as gt,t as Me,u as bt,v as yt,w as T,T as C,x as de,y as ze,L as me,z as pe,A as vt,C as Ve,D as he,E as wt,F as He,G as Ct,H as Nt,J as be,K as ye,M as ve,N as It,O as $,P as we,Q as re,R as Ee,S as pr,U as je,V as hr,W as ur,X as Re,Y as kt,Z as xr,_ as E,$ as Ce,a0 as We,a1 as oe,a2 as L,a3 as Ke,a4 as Je,a5 as fr,a6 as jr,a7 as gr,a8 as br,a9 as yr,aa as vr,ab as wr,ac as Cr,ad as Nr,ae as Ir,af as De,ag as q,ah as kr,ai as Sr,aj as Er,ak as Dr,al as $r,am as Pr}from"./@mui-Bm4MEgRN.js";import{F as $e,f as Tr,a as Fr,b as Rr}from"./@fortawesome-B_BO272m.js";import{P as k}from"./prop-types-BLb_kr1z.js";import{E as qe}from"./jspdf-1OTHLx97.js";/* empty css                        */import{C as Br,R as ee,a as U,B as le,b as Or,c as W,M as Xe,d as Be,I as Pe}from"./react-bootstrap-jP7WpjRJ.js";import{a as Ar}from"./jspdf-autotable-DDmGA3_C.js";import{d as Lr}from"./@remix-run-Lznw-q9N.js";import{A as Mr,l as zr,p as Hr,C as Wr}from"./@cloudinary-BMhsXWNp.js";import"./@babel-DHtTW5jQ.js";import"./scheduler-CzFDRTuY.js";import"./@pdf-lib-Z8p5nqKo.js";import"./pako-twDzheqF.js";import"./deepmerge-DhIoniG1.js";import"./lodash-es-dVqQl90_.js";import"./react-fast-compare--XvtpQai.js";import"./hoist-non-react-statics-B45myv23.js";import"./property-expr-DEi1ZLzV.js";import"./tiny-case-BJ7jYKNY.js";import"./toposort-Rw6gryco.js";import"./goober-vt3s6TGe.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-BYGI21Ed.js";import"./react-is-DcfIKM1A.js";import"./@emotion-BrFOSRJr.js";import"./stylis-BqmD5Vow.js";import"./fflate-Cf-_J6lE.js";import"./classnames-Dhuh0gey.js";import"./dom-helpers-CRQpUKSM.js";import"./@restart-XqyQPHB-.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function a(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=a(s);fetch(s.href,l)}})();const St=p.createContext(null),Qe="https://sincro.pro:3001";function Ne(){return p.useContext(St)}function Et({children:r}){const[t,a]=p.useState(null),[o,s]=p.useState(""),l=z();async function i(c,m){try{const j=await fetch(`${Qe}/users/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,password:m})}),w=await j.json();if(j.ok)localStorage.setItem("token",w.token),a(w.user),s(""),l("/home");else throw new Error(w.message||"Error de autenticación")}catch(j){console.error("Error al intentar iniciar sesión:",j),s(j.message),a(null)}}async function d(){try{localStorage.removeItem("token"),a(null),l("/login")}catch(c){console.error("Error al intentar cerrar sesión:",c),s(c.message)}}async function h(){const c=localStorage.getItem("token");if(c)try{const m=await fetch(`${Qe}/users/verify-token`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}});if(m.ok){const j=await m.json();a(j.user)}else d()}catch(m){console.error("Error verifying token:",m),d()}}const n={auth:t,login:i,logout:d,errorMessage:o,checkAuth:h};return e.jsx(St.Provider,{value:n,children:r})}const qr=p.createContext();function Ur({children:r}){const[t,a]=p.useState(!1);async function o(s,l){a(!0);const i=await Zt.create(),d=await i.embedFont(er.TimesRoman),h=i.addPage(),{width:n,height:c}=h.getSize(),m=11;let j=c-50;h.drawText(`Nombre: ${s.name}`,{x:50,y:j,size:m,font:d}),j-=15,h.drawText(`Obra: ${s.proyect}`,{x:50,y:j,size:m,font:d}),l.forEach(g=>{j-=15,h.drawText(`Fecha: ${g.date}, Horas Regulares: ${g.hour}, Extras: ${g.minutes}`,{x:50,y:j,size:m,font:d})});const w=await i.save();return a(!1),w}return e.jsx(qr.Provider,{value:{createPdf:o,loading:t},children:r})}const Oe={hiringCompany:"",projectName:"",addressDescription:"",block:"",unit:"",zipCode:"",province:"",typeOfWork:"finishings",constructionType:"other",startDate:se().format("YYYY-MM-DD"),endDate:se().format("YYYY-MM-DD"),sections:[],projectDescription:"",status:"noIniciado",image:null},Dt=K().shape({projectName:I().nullable(!0),hiringCompany:I().nullable(!0),block:I().max(20).nullable(!0),unit:I().max(10).nullable(!0),addressDescription:I().nullable(!0),zipCode:J().nullable(!0).typeError("Debe ser un número"),province:I().nullable(!0),typeOfWork:I().oneOf(["construction","finishings","installations","solarPanels","other"]).nullable(!0),constructionType:I().oneOf(["chalet","apartment","rural","other"]).nullable(!0),startDate:Z().nullable(!0).typeError("Debe ser una fecha válida"),endDate:Z().nullable(!0).typeError("Debe ser una fecha válida"),projectDescription:I().nullable(!0),sections:Te().of(I()).nullable(!0),status:I().oneOf(["noIniciado","iniciado","terminado"]).nullable(!0),image:rr().nullable(!0)}),_r="https://sincro.pro:3001",Gr=async r=>{try{const t=localStorage.getItem("token"),a=new FormData;for(const l in r)l!=="image"&&a.append(l,r[l]);r.image&&a.append("image",r.image);const o=await fetch(`${_r}/projects`,{method:"POST",headers:{Authorization:`Bearer ${t}`},body:a});if(!o.ok)throw new Error("Failed to submit form data with status: "+o.status);const s=await o.json();return console.log("respuesta despues de recibir el respose del fetch",s),s}catch(t){throw console.error("Error al enviar datos del formulario",t),t}};function Yr(){const r=z();return e.jsx(_,{initialValues:Oe,validationSchema:Dt,onSubmit:(t,a)=>{Gr(t).then(()=>{a.setSubmitting(!1),a.resetForm(),R.success("Proyecto creado correctamente!"),r("/my-projects")}).catch(o=>{console.error("Error en el proceso:",o),a.setSubmitting(!1),R.error("Error al crear el proyecto")})},children:({isSubmitting:t,setFieldValue:a,values:o,handleChange:s,errors:l,touched:i})=>e.jsxs(G,{className:"w-100",children:[e.jsx("div",{className:"container-fluid mt-5 ",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-md-10 shadow",children:[e.jsx("h4",{className:"text-center mb-4",children:"Crear Proyecto"}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"projectName",className:"form-label ms-2",children:"Nombre del Proyecto"}),e.jsx(v,{type:"text",name:"projectName",className:`form-control ${i.projectName&&l.projectName?"is-invalid":""}`,placeholder:"Nombre del proyecto",onChange:s,value:o.projectName}),i.projectName&&l.projectName&&e.jsx("div",{className:"invalid-feedback",children:l.projectName})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"hiringCompany",className:"form-label ms-2",children:"Empresa Contratante"}),e.jsx(v,{type:"text",name:"hiringCompany",className:`form-control ${i.hiringCompany&&l.hiringCompany?"is-invalid":""}`,placeholder:"Empresa Contratante",onChange:s,value:o.hiringCompany}),i.hiringCompany&&l.hiringCompany&&e.jsx("div",{className:"invalid-feedback",children:l.hiringCompany})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"block",className:"form-label ms-2",children:"Bloque"}),e.jsx(v,{type:"text",name:"block",className:`form-control ${i.block&&l.block?"is-invalid":""}`,placeholder:"Bloque",onChange:s,value:o.block}),i.block&&l.block&&e.jsx("div",{className:"invalid-feedback",children:l.block})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"unit",className:"form-label ms-2",children:"Unidad"}),e.jsx(v,{type:"text",name:"unit",className:`form-control ${i.unit&&l.unit?"is-invalid":""}`,placeholder:"Unidad",onChange:s,value:o.unit}),i.unit&&l.unit&&e.jsx("div",{className:"invalid-feedback",children:l.unit})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"addressDescription",className:"form-label ms-2",children:"Descripción de la Dirección"}),e.jsx(v,{type:"text",name:"addressDescription",className:`form-control ${i.addressDescription&&l.addressDescription?"is-invalid":""}`,placeholder:"Dirección del proyecto",onChange:s,value:o.addressDescription}),i.addressDescription&&l.addressDescription&&e.jsx("div",{className:"invalid-feedback",children:l.addressDescription})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"zipCode",className:"form-label ms-2",children:"Código Postal"}),e.jsx(v,{type:"text",name:"zipCode",className:`form-control ${i.zipCode&&l.zipCode?"is-invalid":""}`,placeholder:"Código Postal",onChange:s,value:o.zipCode}),i.zipCode&&l.zipCode&&e.jsx("div",{className:"invalid-feedback",children:l.zipCode})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"province",className:"form-label ms-2",children:"Provincia"}),e.jsx(v,{type:"text",name:"province",className:`form-control ${i.province&&l.province?"is-invalid":""}`,placeholder:"Provincia",onChange:s,value:o.province}),i.province&&l.province&&e.jsx("div",{className:"invalid-feedback",children:l.province})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"typeOfWork",className:"form-label ms-2",children:"Tipo de Trabajo"}),e.jsxs(v,{as:"select",name:"typeOfWork",className:`form-select ${i.typeOfWork&&l.typeOfWork?"is-invalid":""}`,onChange:s,value:o.typeOfWork,children:[e.jsx("option",{value:"",children:"Selecciona un tipo"}),e.jsx("option",{value:"construction",children:"Construcción"}),e.jsx("option",{value:"finishings",children:"Repasos"}),e.jsx("option",{value:"installations",children:"Instalación de equipos"}),e.jsx("option",{value:"solarPanels",children:"Instalación de paneles solares"}),e.jsx("option",{value:"other",children:"Otra"})]}),i.typeOfWork&&l.typeOfWork&&e.jsx("div",{className:"invalid-feedback",children:l.typeOfWork})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"constructionType",className:"form-label ms-2",children:"Tipo de Construcción"}),e.jsxs(v,{as:"select",name:"constructionType",className:`form-select ${i.constructionType&&l.constructionType?"is-invalid":""}`,onChange:s,value:o.constructionType,children:[e.jsx("option",{value:"",children:"Selecciona un tipo"}),e.jsx("option",{value:"chalet",children:"Chalet"}),e.jsx("option",{value:"apartment",children:"Piso"}),e.jsx("option",{value:"rural",children:"Rural"}),e.jsx("option",{value:"other",children:"Otra"})]}),i.constructionType&&l.constructionType&&e.jsx("div",{className:"invalid-feedback",children:l.constructionType})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"startDate",className:"form-label ms-2",children:"Fecha de Inicio"}),e.jsx(v,{type:"date",name:"startDate",className:`form-control ${i.startDate&&l.startDate?"is-invalid":""}`,onChange:s,value:o.startDate}),i.startDate&&l.startDate&&e.jsx("div",{className:"invalid-feedback",children:l.startDate})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"endDate",className:"form-label ms-2",children:"Fecha de Finalización"}),e.jsx(v,{type:"date",name:"endDate",className:`form-control ${i.endDate&&l.endDate?"is-invalid":""}`,onChange:s,value:o.endDate}),i.endDate&&l.endDate&&e.jsx("div",{className:"invalid-feedback",children:l.endDate})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"projectDescription",className:"form-label ms-2",children:"Descripción del Proyecto"}),e.jsx(v,{as:"textarea",name:"projectDescription",className:`form-control ${i.projectDescription&&l.projectDescription?"is-invalid":""}`,placeholder:"Descripción del proyecto",onChange:s,value:o.projectDescription}),i.projectDescription&&l.projectDescription&&e.jsx("div",{className:"invalid-feedback",children:l.projectDescription})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{className:"form-label ms-2",children:"Agregar Imagen"}),e.jsx("input",{type:"file",name:"image",className:"form-control",onChange:d=>{const h=d.target.files[0];console.log("Archivo seleccionado desde la vista createNewProject:",h),h&&a("image",h)}}),o.image&&e.jsx("img",{src:URL.createObjectURL(o.image),alt:"Preview",className:"img-fluid mt-3",style:{maxHeight:"200px"}})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-3 mb-5 mt-5",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>r("/my-projects"),disabled:t,children:"Cancelar"}),e.jsx("button",{type:"submit",className:"btn btn-primary ",disabled:t,children:t?"Creando...":"Crear Proyecto"})]})]})})}),e.jsx(ce,{})]})})}const Ue=[{name:"Proyectos",path:"/my-projects",icon:e.jsx(ar,{sx:{color:"#F0ED38",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Pendientes",path:"/pendings",icon:e.jsx(sr,{sx:{color:"#D6556C",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Pedidos",path:"/order-list",icon:e.jsx(or,{sx:{color:"#DA8F44",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Contactos",path:"/allContacts",icon:e.jsx(nr,{sx:{color:"#29BADE",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Personal",path:"/staff-list",icon:e.jsx(ir,{sx:{color:"#84C7AE",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Reportes",path:"/reports",icon:e.jsx(lr,{sx:{color:"#AD6DF1",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})},{name:"Salir",path:"/login",icon:e.jsx(cr,{sx:{color:"#AD6DF1",fontSize:"65px",paddingTop:"15px",paddingBottom:"15px",cursor:"pointer"}})}];function Vr(){const[r,t]=p.useState(!1),a=()=>{t(!r)};return e.jsxs("div",{className:"d-flex flex-column vh-100  border-end  ",style:{width:r?"80px":"250px",transition:"width 0.3s",marginTop:"40px",paddingTop:"1em"},children:[e.jsx("button",{className:"btn btn-outline-secondary mb-2 mx-auto ",onClick:a,children:r?e.jsx(dr,{}):e.jsx(mr,{})}),e.jsx("ul",{className:"nav flex-column mt-2",children:Ue.map((o,s)=>e.jsx("li",{className:"nav-item",children:e.jsxs(ae,{to:o.path,className:"nav-link d-flex align-items-center px-3 py-2",style:{transition:"transform 0.2s, box-shadow 0.2s",borderRadius:"5px","&:hover":{transform:"scale(1.05)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)",backgroundColor:"#f8f9fa"}},children:[e.jsx("span",{className:"me-2",children:o.icon}),!r&&e.jsx("span",{className:"text-muted",children:o.name})]})},s))})]})}const Kr="https://sincro.pro:3001",ue=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${Kr}/projects`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(t.ok)return await t.json()||[];throw new Error("Fallo en cargar los proyectos: "+t.status)}catch(r){throw console.error("Error al obtener tus proyectos:",r),r}},Jr="https://sincro.pro:3001",Xr=async r=>{try{const t=localStorage.getItem("token");if(!(await fetch(`${Jr}/projects/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).ok)throw new Error("No se pudo eliminar el proyecto");return r}catch(t){throw console.error("Error al eliminar el proyecto:",t),t}};function Qr(){const[r,t]=p.useState([]),[a,o]=p.useState("loading"),s=z();p.useEffect(()=>{(async()=>{try{const h=await ue();h.length>0?(t(h),o("success")):o("empty")}catch(h){console.error("Error de conexión:",h),o("error")}})()},[]);const l=d=>{s(`/project-info/${d}`)},i=async d=>{if(window.confirm("¿Estás seguro que quieres borrar el proyecto? No podrás recuperar los datos."))try{await Xr(d),t(n=>n.filter(c=>c.projectId!==d))}catch(n){console.error("Error al eliminar el proyecto:",n)}};return e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"row vh-100",children:[e.jsx("div",{className:"d-none d-md-block col-md-3 ",children:e.jsx(Vr,{})}),e.jsxs("div",{className:"col-12 col-md-9 p-4 ",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-5 mt-5",children:[e.jsx("h5",{className:"text-dark",children:"Lista activa"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>s("/create-new-project"),children:"Agregar Nuevo"})]}),a==="loading"&&e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Cargando..."})})}),a==="empty"&&e.jsx("div",{className:"alert alert-info text-center",children:"No hay proyectos creados para este usuario. Favor crear un proyecto."}),a==="error"&&e.jsx("div",{className:"alert alert-danger text-center",children:error||"Ha ocurrido un error al cargar los proyectos."}),a==="success"&&e.jsx("div",{className:"row",children:r.sort((d,h)=>new Date(h.startDate)-new Date(d.startDate)).map(d=>e.jsx("div",{className:"col-12 mb-3",children:e.jsxs("div",{className:"project-container d-flex justify-content-between align-items-center p-3 border shadow-sm",onClick:()=>l(d.projectId),style:{cursor:"pointer",transition:"all 0.2s"},children:[e.jsxs("div",{className:"d-flex gap-3 align-align-items-center ",children:[e.jsx("h6",{className:"mb-1",children:d.projectName}),e.jsx("p",{className:"text-muted mb-0",children:d.startDate})]}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx("button",{className:"btn btn-link text-primary p-1",onClick:h=>{h.stopPropagation(),s(`/project-edit-info/${d.projectId}`)},children:e.jsx($e,{icon:Tr})}),e.jsx("button",{className:"btn btn-link text-info p-1",onClick:h=>{h.stopPropagation(),s(`/project-info/${d.projectId}`)},children:e.jsx($e,{icon:Fr})}),e.jsx("button",{className:"btn btn-link text-danger p-1",onClick:h=>{h.stopPropagation(),i(d.projectId)},children:e.jsx($e,{icon:Rr})})]})]})},d.projectId))})]})]})})}const Zr="https://sincro.pro:3001",$t=async r=>{try{const t=localStorage.getItem("token");if(!(await fetch(`${Zr}/tasks/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}})).ok)throw new Error("No se pudo eliminar la tarea")}catch(t){console.error("Error al eliminar la tarea:",t)}},ea="https://sincro.pro:3001",_e=async(r,t)=>{try{const a=localStorage.getItem("token"),o=`${ea}/tasks/${r}/${t}`;console.log("Requesting URL:",o),console.log("Token:",a);const s=await fetch(o,{method:"GET",headers:{Authorization:`Bearer ${a}`}});if(s.ok){const l=await s.json();return l.length>0?l:null}else{if(s.status===404)return null;throw new Error("Ha habido un fallo al obtener el estatus de la tarea")}}catch(a){throw console.error("Error al obtener la tarea:",a),a}},Ze=r=>fetch(r).then(t=>t.blob()).then(t=>new Promise((a,o)=>{const s=new FileReader;s.onloadend=()=>a(s.result),s.onerror=o,s.readAsDataURL(t)})),Pt=({tasks:r,fileName:t,additionalInfo:a})=>{const o=async()=>{const s=new qe;for(const[l,i]of r.entries()){const d=10+l*130;s.setFontSize(12),s.setFont("helvetica","bold"),s.text("REPORTE",10,d);const n=d+10+10;if(s.text(`Tarea:  ${i.taskName}`,10,n),s.setFont("helvetica","normal"),s.setFontSize(10),s.text(`Descripción del trabajo: ${i.taskDescription}`,10,n+10),s.text(`Fecha de inicio: ${i.startDate}`,10,n+20),s.text(`Fecha de entrega: ${i.endDate}`,10,n+30),s.text(`Descripción de trabajo realizado: ${a}`,10,n+40),s.setLineWidth(.1),s.line(10,n+50,200,n+50),s.setFont("helvetica","bold"),s.text("Imágenes Iniciales:",10,n+60),i.prevImages&&i.prevImages.length>0)for(const[c,m]of i.prevImages.entries()){const j=await Ze(m),w=10+c*70,g=n+70,b=50,u=50;s.setDrawColor(0),s.setFillColor(255,255,255),s.rect(w-2,g-2,b+4,u+4,"FD"),s.addImage(j,"JPEG",w,g,b,u)}if(s.text("Imágenes Finales:",10,n+130),i.finalImages&&i.finalImages.length>0)for(const[c,m]of i.finalImages.entries()){const j=await Ze(m),w=10+c*70,g=n+140,b=50,u=50;s.setDrawColor(0),s.setFillColor(255,255,255),s.rect(w-2,g-2,b+4,u+4,"FD"),s.addImage(j,"JPEG",w,g,b,u)}}s.save(t)};return e.jsx("button",{style:{marginTop:"2em",backgroundColor:"#1976D2",color:"#fff",border:"none",padding:".5em 1em",borderRadius:"5px"},onClick:o,children:"Crear PDF"})};Pt.propTypes={tasks:k.arrayOf(k.object),fileName:k.string,additionalInfo:k.string};const ta="https://sincro.pro:3001",ne=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${ta}/projects/${r}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(a.ok)return await a.json();throw new Error("Failed to get project with status: "+a.status)}catch(t){throw console.error("Error al obtener el proyecto:",t),t}},ra=window.SpeechRecognition||window.webkitSpeechRecognition,Tt=({onTextChange:r})=>{const[t,a]=p.useState(!1),o=new ra;o.continuous=!0,o.interimResults=!0,o.lang="es-ES",o.onresult=l=>{const i=Array.from(l.results).map(d=>d[0]).map(d=>d.transcript).join("");r(i)};const s=()=>{t?o.stop():o.start(),a(!t)};return e.jsx(ct,{position:"end",children:e.jsx(A,{onClick:s,color:"primary",children:t?e.jsx(dt,{}):e.jsx(mt,{})})})},xe=({src:r,alt:t})=>{const[a,o]=p.useState(!1),s=()=>{o(!a)};return e.jsx(f,{component:"img",src:r,alt:t,onClick:s,sx:{width:a?"400px":"100px",height:a?"400px":"100px",transition:"width 0.3s ease, height 0.3s ease",marginRight:"1em",cursor:"pointer"}})};xe.propTypes={src:k.string,alt:k.string};const Ge=p.createContext(),aa={pool:{icon:e.jsx(pt,{}),name:"Piscina"},kitchen:{icon:e.jsx(ht,{}),name:"Cocina"},laundry:{icon:e.jsx(ut,{}),name:"Lavandería"},roof:{icon:e.jsx(xt,{}),name:"Techo"},terrace:{icon:e.jsx(ft,{}),name:"Terraza"},room:{icon:e.jsx(jt,{}),name:"Habitación"},bathRoom:{icon:e.jsx(gt,{}),name:"Baño"},hall:{icon:e.jsx(Me,{}),name:"Pasillo"},livingRoom:{icon:e.jsx(bt,{}),name:"Sala de estar"}},sa=({children:r})=>{const[t,a]=p.useState(aa),o=s=>{const l={...t};s.forEach(i=>{l[i]||(l[i]={icon:e.jsx(Me,{}),name:i})}),a(l)};return e.jsx(Ge.Provider,{value:{sectionMapping:t,updateSectionMapping:o},children:r})};function Ye({status:r}){let t;return r==="iniciado"?t="#F2CB05":r==="terminado"?t="#8BB443":t="#F25244",e.jsx(f,{children:e.jsx(yt,{sx:{color:t}})})}const ge=({projectId:r,sectionKey:t})=>{var H;const[a,o]=p.useState([]),[s,l]=p.useState(null),i=z(),[d,h]=p.useState(null),[n,c]=p.useState(!1),[m,j]=p.useState(null),[w,g]=p.useState(""),{sectionMapping:b}=p.useContext(Ge),[u,y]=p.useState(null);p.useEffect(()=>{(async()=>{const M=await ne(r);h(M)})()},[r]),p.useEffect(()=>{console.log("Fetching tasks for:",r,t),(async()=>{if(r&&t)try{const M=await _e(r,t);M===null?(y("No hay tareas disponibles para esta sección."),o([])):(o(M),console.log("Tasks set in state:",M))}catch(M){console.error("Error fetching tasks:",M),y("Error al obtener las tareas."),o([])}})()},[r,t]);const x=async S=>{if(window.confirm("¿Estás seguro de que deseas eliminar esta tarea?"))try{await $t(S),o(V=>V.filter(ke=>ke.taskId!==S)),R.success("Tarea eliminada exitosamente")}catch(V){console.error("Error eliminando la tarea:",V)}},N=p.useCallback(S=>{l(s===S?null:S)},[s]),B=p.useCallback(S=>{j(S),c(!0)},[]),Y=p.useCallback(()=>{c(!1),j(null)},[]),P=p.useCallback(S=>{g(S)},[]);return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-flex justify-content-around",children:[e.jsxs("h5",{className:"text-left mt-3 mb-3",children:["Proyecto: ",d?d.projectName:"Cargando..."]}),e.jsxs("h5",{className:"text-left mt-3 mb-3",children:["Sección: ",((H=b[t])==null?void 0:H.name)||t]})]}),u?e.jsx("div",{className:"alert alert-danger",children:u}):a.length===0?e.jsx("p",{children:"No hay tareas para esta sección."}):a.map(S=>e.jsxs(Br,{className:"mb-3 w-100 mw-100 p-2",children:[e.jsxs(ee,{className:"w-100",children:[e.jsx(U,{xs:10,className:"mb-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[S.status&&e.jsx(Ye,{status:S.status}),e.jsx("h6",{className:"ms-3 ml-3 mb-0",children:S.taskName})]})}),e.jsxs(U,{xs:2,className:"d-flex justify-content-end",children:[e.jsx(le,{variant:"link",onClick:()=>N(S.taskId),children:s===S.taskId?e.jsx("i",{className:"bi bi-chevron-up"}):e.jsx("i",{className:"bi bi-chevron-down"})}),e.jsx(le,{variant:"link",onClick:()=>i(`/edit-task/${S.taskId}`),children:"Editar"}),e.jsx(le,{variant:"link",className:"text-danger",onClick:()=>x(S.taskId),children:"Eliminar"})]})]}),e.jsx(Or,{in:s===S.taskId,children:e.jsxs("div",{className:"mt-3 text-start p-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Descripción: "}),S.taskDescription]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Trabajador: "}),S.employeeName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de inicio: "}),S.startDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de fin: "}),S.endDate]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:e.jsx("strong",{children:"Imágenes Iniciales:"})}),e.jsx("div",{className:"d-flex flex-wrap",children:Array.isArray(S.prevImages)&&S.prevImages.map((M,V)=>e.jsx(xe,{src:M,alt:`Inicial ${V}`,onClick:()=>B(M)},V))})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("p",{children:e.jsx("strong",{children:"Imágenes Finales:"})}),e.jsx("div",{className:"d-flex flex-wrap",children:Array.isArray(S.finalImages)&&S.finalImages.map((M,V)=>e.jsx(xe,{src:M,alt:`Final ${V}`,onClick:()=>B(M)},V))})]}),e.jsx("div",{className:"mt-3",children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Escribe aquí información que solo aparecerá en tu pdf:"}),e.jsx(W.Control,{as:"textarea",placeholder:"Escribe información adicional aquí...",value:w,onChange:M=>g(M.target.value)}),e.jsx(Tt,{onTextChange:P})]})}),d&&e.jsx(Pt,{project:d,tasks:[S],additionalInfo:w,fileName:`reporte_${d.projectName}_${S.taskName}.pdf`})]})})]},S.taskId)),e.jsx(Xe,{show:n,onHide:Y,centered:!0,children:e.jsx(Xe.Body,{children:m&&e.jsx(xe,{src:m,alt:"Selected",style:{maxWidth:"100%"}})})})]})};ge.propTypes={projectId:k.string.isRequired,sectionKey:k.string.isRequired};const oa="https://sincro.pro:3001",na=async(r,t)=>{try{const a=localStorage.getItem("token"),o=await fetch(`${oa}/projects/${r}/sections`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({section:t})});if(!o.ok)throw new Error("No se pudo agregar la nueva sección");return await o.json()}catch(a){console.error("Error al agregar la sección:",a)}};function fe({buttonText:r,onClick:t}){const[a,o]=p.useState(!1);return e.jsx(f,{sx:{display:"flex",justifyContent:"center"},children:e.jsxs(T,{sx:{display:"flex",alignSelf:"flex-end",color:"#021F59",border:"1px solid #1975D2",marginBottom:"1em",borderRadius:"5px",alignItems:"center"},onClick:t,onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:[e.jsx(C,{sx:{paddingLeft:".6em"},children:a&&r===""?"Agregar Sección":r}),e.jsx(de,{sx:{color:"#1976D2",fontSize:"35px",paddingLeft:".6em"}})]})})}fe.propTypes={buttonText:k.string,onClick:k.func.isRequired};const et=240,ia=()=>{const{projectId:r}=X(),[t,a]=p.useState(null),[o,s]=p.useState(null),[l,i]=p.useState(!0),[d,h]=p.useState(!1),[n,c]=p.useState(""),[m,j]=p.useState({}),{sectionMapping:w,updateSectionMapping:g}=p.useContext(Ge),b=z(),u=ze("(max-width:600px)");p.useEffect(()=>{(async()=>{if(r){i(!0);try{const H=await ne(r);if(a(H),H.sections&&Array.isArray(H.sections)&&H.sections.length>0){s(H.sections[0]);const S=H.sections.filter(M=>!w[M]);S.length>0&&g(S)}}catch(H){console.error("Error fetching project data:",H)}finally{i(!1)}}})()},[r,w,g]);const y=()=>{h(!0)},x=()=>{h(!1),c("")},N=P=>{u?j(H=>{const S={...H,[P]:!H[P]};return S[P]&&s(P),S}):s(P)},B=async()=>{try{await na(r,n)?(a(H=>({...H,sections:[...H.sections,n]})),g([n]),x(),R.success("La sección ha sido agregada correctamente!")):(R.error("No se ha podido agregar la sección."),console.error("Error: No se pudo agregar la sección"))}catch(P){console.error("Error al agregar la sección:",P)}};if(l)return e.jsx("p",{children:"Cargando proyecto..."});if(!t)return e.jsx("p",{children:"No se encontró el proyecto"});const Y=e.jsxs(f,{sx:{width:"100%"},children:[e.jsx(me,{children:t.sections&&t.sections.map(P=>e.jsxs("div",{children:[e.jsxs(pe,{onClick:()=>N(P),sx:{borderRadius:"5px",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer","&:hover":{transform:"scale(1.02)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(vt,{children:w[P]?w[P].icon:e.jsx(Ve,{})}),e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",width:"100%"},children:[e.jsx(he,{primary:w[P]?w[P].name:P}),u?e.jsx(wt,{sx:{color:"grey"}}):e.jsx(Ve,{sx:{color:"grey"}})]})]}),u&&e.jsx(He,{in:m[P],timeout:"auto",unmountOnExit:!0,children:e.jsxs(f,{sx:{margin:"0 16px"},children:[e.jsx(ge,{projectId:r,sectionKey:P}),e.jsx(fe,{buttonText:"Agregar Tarea",onClick:()=>b(`/project-create-task/${r}/${P}`)})]})})]},P))}),e.jsx(f,{sx:{marginTop:"2em",display:"flex",width:u?"250px":"100%",justifyContent:"center"},children:e.jsx(fe,{buttonText:"Agregar Sección",onClick:y})})]});return e.jsxs(f,{sx:{display:"flex",height:"100vh",overflowX:"hidden"},children:[e.jsxs(Ct,{variant:"permanent",sx:{width:u?"100%":et,flexShrink:0,top:"64px","& .MuiDrawer-paper":{width:u?"100%":et,boxSizing:"border-box",top:"64px"}},children:[Y,e.jsx(T,{variant:"contained",sx:{marginTop:2,width:"200px",display:"flex",margin:"2em auto",backgroundColor:"#218BFE","&:hover":{backgroundColor:"#1976d2"}},onClick:()=>b(`/project-info-data/${r}`),children:"Datos del proyecto"})]}),e.jsxs(f,{component:"main",sx:{flexGrow:1,p:1,margin:u?"0 16px":"0"},children:[e.jsx(Nt,{}),!u&&o&&e.jsxs(e.Fragment,{children:[e.jsx(f,{sx:{display:"flex",justifyContent:"center"},children:e.jsx(fe,{buttonText:"Agregar Tarea",onClick:()=>b(`/project-create-task/${r}/${o}`)})}),e.jsx(ge,{projectId:r,sectionKey:o})]})]}),e.jsxs(be,{open:d,onClose:x,children:[e.jsx(ye,{children:"Agregar Nueva Sección"}),e.jsxs(ve,{children:[e.jsx(It,{children:"Por favor, ingrese el nombre de la nueva sección que desea agregar."}),e.jsx($,{autoFocus:!0,margin:"dense",label:"Nombre de la Sección",type:"text",fullWidth:!0,value:n,onChange:P=>c(P.target.value)})]}),e.jsxs(we,{children:[e.jsx(T,{onClick:x,color:"primary",children:"Cancelar"}),e.jsx(T,{onClick:B,color:"primary",children:"Agregar"})]})]})]})},la="https://sincro.pro:3001",ca=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${la}/tasks/`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(t.ok)return await t.json();throw new Error("Fallo en cargar las tareas: "+t.status)}catch(r){throw console.error("Error al obtener tus tareas:",r),r}},da="https://sincro.pro:3001",ma=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${da}/pendings`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(r)});if(a.ok)return await a.json();throw new Error("Failed to submit form data with status: "+a.status)}catch(t){console.error("Error al enviar datos del formulario",t)}},pa="https://sincro.pro:3001",Ft=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${pa}/orders/`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(t.ok){const a=await t.json();return a.length===0?(console.log("No se han encontrado pedidos"),[]):a}else throw new Error(`Error al obtener pedidos: ${t.status}`)}catch(r){throw console.error("Error al obtener tus pedidos:",r),r}},ha="https://sincro.pro:3001",Ie=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${ha}/employees`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(!t.ok)throw new Error("Network response was not ok");return await t.json()}catch(r){return console.error("Error fetching employees:",r),[]}},ua="https://sincro.pro:3001",xa=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${ua}/pendings/`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(t.ok)return await t.json();throw new Error("Fallo en cargar las tareas: "+t.status)}catch(r){throw console.error("Error al obtener tus tareas:",r),r}},fa="https://sincro.pro:3001",ja=async r=>{try{const t=localStorage.getItem("token");if(!(await fetch(`${fa}/pendings/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}})).ok)throw new Error("No se pudo eliminar el pendiente");R.success("El pendiente ha sido borrado exitosamente!")}catch(t){console.error("Error al eliminar la tarea, intente de nuevo deletePending:",t),R.error("El pendiente se ha podido borrar!")}};function ga(){const[r,t]=p.useState([]),[a,o]=p.useState([]),[s,l]=p.useState([]),[i,d]=p.useState([]),[h,n]=p.useState(!1),c=z();p.useEffect(()=>{async function x(){try{const N=await ca();t(N.filter(B=>B.status!=="terminado"))}catch(N){console.error("Error al obtener las tareas:",N)}}x()},[]),p.useEffect(()=>{async function x(){try{const N=await Ie();o(N.filter(B=>B.mandatoryEquipment!=="si"))}catch(N){console.error("Failed to fetch employees:",N)}}x()},[]),p.useEffect(()=>{async function x(){try{const N=await Ft();l(N.filter(B=>B.status==="pendiente"))}catch(N){console.error("Failed to fetch orders:",N)}}x()},[]),p.useEffect(()=>{async function x(){try{const N=await xa();d(N.filter(B=>B.status!=="terminado"))}catch(N){console.error("Error al obtener los pendientes:",N)}}x()},[h]);const m=K().shape({date:Z().required("La fecha es requerida"),details:I().required("Los detalles son requeridos")}),j=async(x,N)=>{const B=localStorage.getItem("userId");try{const Y=await ma({details:x.details.trim(),status:"pendiente",date:new Date().toISOString(),userId:B});d(P=>[...P,Y]),n(!h),N.resetForm()}catch(Y){console.error("Failed to add pending:",Y)}finally{N.setSubmitting(!1)}},w=async x=>{try{await ja(x),d(N=>N.filter(B=>B.pendingId!==x))}catch(N){console.error("Failed to delete pending:",N)}},g=x=>{t(r.filter(N=>N.taskId!==x))},b=x=>{o(a.filter(N=>N.employeeId!==x))},u=x=>{l(s.filter(N=>N.orderId!==x))},y=(x,N)=>{switch(N){case"task":c(`/edit-task/${x}`);break;case"employee":c(`/employee/${x}`);break;case"order":c(`/order-details/${x}`);break}};return e.jsx(e.Fragment,{children:e.jsxs(f,{display:"flex",padding:3,marginTop:"2em",flexDirection:"column",gap:3,children:[e.jsx(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff"},children:e.jsx(_,{initialValues:{date:new Date().toISOString().slice(0,10),details:"",status:"pendiente"},validationSchema:m,onSubmit:j,children:({isSubmitting:x,handleChange:N,setFieldValue:B,values:Y})=>e.jsxs(G,{children:[e.jsx(v,{as:$,label:"Nuevo pendiente",name:"details",value:Y.details,onChange:N,variant:"outlined",fullWidth:!0,margin:"normal",InputProps:{endAdornment:e.jsx(Tt,{onTextChange:P=>B("details",P)})}}),e.jsx(T,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,sx:{marginTop:2,":hover":{backgroundColor:"#fff",color:"#1976d2"}},disabled:x,children:"Agregar Pendiente"})]})})}),e.jsxs(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",transition:"transform 0.2s, box-shadow 0.2s"},children:[e.jsx(C,{sx:{paddingLeft:"1em",marginBottom:2,textAlign:"left"},variant:"h6",children:"Mis Pendientes creados"}),i.map(x=>e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #f0efef",marginBottom:"1em",backgroundColor:"#fff",borderRadius:"5px",padding:".5em 1.5em",cursor:"pointer",":hover":{backgroundColor:"#f9f9f9"}},children:[e.jsxs(C,{sx:{textAlign:"left"},children:[x.date," - ",x.details]}),e.jsx(A,{sx:{color:"red"},edge:"end","aria-label":"delete",onClick:()=>w(x.pendingId),children:e.jsx(re,{})})]},x.pendingId))]}),e.jsxs(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",transition:"transform 0.2s, box-shadow 0.2s"},children:[e.jsx(C,{variant:"h6",textAlign:"left",marginBottom:"1em",children:"Tareas Pendientes"}),r.map(x=>e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #f0efef",marginBottom:"1em",borderRadius:"5px",padding:".5em 1.5em",backgroundColor:"#fff",cursor:"pointer",":hover":{backgroundColor:"#f9f9f9"}},children:[e.jsxs(C,{sx:{textAlign:"left"},children:[x.status," - ",x.taskName]}),e.jsxs(f,{children:[e.jsx(A,{onClick:()=>y(x.taskId,"task"),children:e.jsx(Ee,{})}),e.jsx(A,{sx:{color:"red"},edge:"end","aria-label":"delete",onClick:()=>g(x.taskId),children:e.jsx(re,{})})]})]},x.taskId))]}),e.jsxs(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",transition:"transform 0.2s, box-shadow 0.2s"},children:[e.jsx(C,{variant:"h6",textAlign:"left",marginBottom:"1em",children:"Trabajadores con equipo incompleto"}),a.map(x=>e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #f0efef",marginBottom:"1em",borderRadius:"5px",padding:".5em 1.5em",backgroundColor:"#fff",cursor:"pointer",":hover":{backgroundColor:"#f9f9f9"}},children:[e.jsxs(C,{sx:{textAlign:"left"},children:[x.name," - ",x.position]}),e.jsxs(f,{children:[e.jsx(A,{onClick:()=>y(x.employeeId,"employee"),children:e.jsx(Ee,{})}),e.jsx(A,{sx:{color:"red"},edge:"end","aria-label":"delete",onClick:()=>b(x.employeeId),children:e.jsx(re,{})})]})]},x.employeeId))]}),e.jsxs(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",transition:"transform 0.2s, box-shadow 0.2s"},children:[e.jsx(C,{variant:"h6",textAlign:"left",paddingLeft:"1em",children:"Pedidos Pendientes"}),s.map(x=>e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",border:"1px solid #f0efef",marginBottom:"1em",backgroundColor:"#fff",borderRadius:"5px",padding:".5em 1.5em",cursor:"pointer",":hover":{backgroundColor:"#f9f9f9"}},children:[e.jsx(C,{sx:{textAlign:"left"},children:x.productName}),e.jsxs(f,{children:[e.jsx(A,{onClick:()=>y(x.orderId,"order"),children:e.jsx(Ee,{})}),e.jsx(A,{sx:{color:"red"},edge:"end","aria-label":"delete",onClick:()=>u(x.orderId),children:e.jsx(re,{})})]})]},x.orderId))]})]})})}function te({label:r,...t}){const[a,o]=lt(t);return e.jsxs(e.Fragment,{children:[e.jsx("label",{children:r}),e.jsx($,{...t,...a,className:o.touched&&o.error?"input-error":"",variant:"outlined",fullWidth:!0}),o.touched&&o.error&&e.jsx("div",{className:"error",children:o.error})]})}const ba="https://sincro.pro:3001",ya=async(r,t)=>{const a=new FormData;Object.keys(r).forEach(o=>{a.append(o,r[o])}),t&&a.append("image",t);try{const o=localStorage.getItem("token"),s=await fetch(`${ba}/orders`,{method:"POST",headers:{Authorization:`Bearer ${o}`},body:a});if(s.ok)return await s.json();throw new Error("Failed to submit /order form data with status: "+s.status)}catch(o){console.error("Error al enviar datos del formulario crear orden",o)}},Rt=K().shape({date:Z(),productName:I(),provider:I(),brand:I(),amount:I(),details:I(),status:I().oneOf(["pendiente","recibido"]),image:I(),projectName:I(),projectId:J()}),Bt=r=>({projectName:(r==null?void 0:r.projectName)||"",projectId:(r==null?void 0:r.projectId)||"",productName:(r==null?void 0:r.productName)||"",provider:(r==null?void 0:r.provider)||"",brand:(r==null?void 0:r.brand)||"",amount:(r==null?void 0:r.amount)||0,details:(r==null?void 0:r.details)||"",status:(r==null?void 0:r.status)||"pendiente",date:(r==null?void 0:r.date)||new Date().toISOString().slice(0,10),image:(r==null?void 0:r.image)||""});function va(){const r=z(),{projectId:t}=X(),[a,o]=p.useState(""),[s,l]=p.useState(null),[i,d]=p.useState(Bt);return p.useEffect(()=>{(async()=>{try{const n=await ue();if(Array.isArray(n)&&n.length>0){l(n);const c=n.find(m=>m.projectId===t);c&&d(m=>({...m,projectId:c.projectId,projectName:c.projectName}))}}catch{console.error("Error al obtener los proyectos: No hay proyectos o permisos denegados")}})()},[t]),s&&s.length===0?e.jsxs("div",{className:"container text-center mt-5",children:[e.jsx("h3",{children:"No tienes proyectos creados."}),e.jsx("p",{children:"Necesitas crear un proyecto para poder realizar un pedido."}),e.jsx("button",{className:"btn btn-primary",onClick:()=>r("/create-project"),children:"Crear Proyecto"})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container mt-5",children:[e.jsxs("p",{className:"text-lg-start",children:["Fecha: ",new Date().toISOString().slice(0,10)]}),e.jsx(_,{initialValues:i,validationSchema:Rt,enableReinitialize:!0,onSubmit:(h,n)=>{ya(h,a).then(()=>{n.setSubmitting(!1),n.resetForm(),R.success("Producto creado correctamente!"),r("/order-list")}).catch(c=>{console.error("Error en el proceso: ",c),n.setSubmitting(!1)})},children:({isSubmitting:h,setFieldValue:n,values:c})=>e.jsx(G,{children:e.jsxs("div",{className:" shadow p-4",children:[e.jsx("h4",{className:"text-center mb-4",children:"Crear Pedido"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"projectId",className:"form-label text-start ms-2",children:"ID del Proyecto"}),e.jsx(v,{name:"projectId",as:te,className:"form-control",readOnly:!0,disabled:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"projectName",className:"form-label text-start ms-2",children:"Nombre del Proyecto"}),e.jsxs(v,{name:"projectName",as:"select",className:"form-select",onChange:m=>{const j=s==null?void 0:s.find(w=>w.projectName===m.target.value);n("projectName",m.target.value),n("projectId",j?j.projectId:"")},value:c.projectName||"",children:[e.jsx("option",{value:"",children:"Seleccionar Proyecto"}),s==null?void 0:s.map(m=>e.jsx("option",{value:m.projectName,children:m.projectName},m.projectId))]})]}),e.jsxs("div",{className:"mb-3 text-start ",children:[e.jsx("label",{htmlFor:"productName",className:"form-label ms-2 ",children:"Nombre"}),e.jsx(v,{name:"productName",className:"form-control",placeholder:"Nombre del Producto"})]}),e.jsxs("div",{className:"mb-3 text-start ",children:[e.jsx("label",{htmlFor:"amount",className:"form-label ms-2",children:"Cantidad"}),e.jsx(v,{name:"amount",className:"form-control",placeholder:"Cantidad"})]}),e.jsxs("div",{className:"mb-3 text-start ",children:[e.jsx("label",{htmlFor:"brand",className:"form-label ms-2 ",children:"Marca"}),e.jsx(v,{name:"brand",className:"form-control",placeholder:"Marca del Producto"})]}),e.jsxs("div",{className:"mb-3 text-start ",children:[e.jsx("label",{htmlFor:"details",className:"form-label ms-2 ",children:"Detalles"}),e.jsx(v,{name:"details",className:"form-control",placeholder:"Detalles del Producto"})]}),e.jsxs("div",{className:"mb-3 text-start ",children:[e.jsx("label",{htmlFor:"provider",className:"form-label ms-2",children:"Proveedor"}),e.jsx(v,{name:"provider",className:"form-control",placeholder:"Opciones de donde comprarlo"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"fileInput",className:"btn btn-outline-primary ",children:"Agregar Imagen"}),e.jsx("input",{id:"fileInput",type:"file",hidden:!0,onChange:m=>o(m.target.files[0])}),a&&e.jsx("img",{src:URL.createObjectURL(a),alt:"Preview",className:"img-fluid mt-3",style:{maxHeight:"200px"}})]}),e.jsx("div",{className:"d-grid mt-3",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h,children:"Crear Producto"})})]})})})]})})}const wa="https://sincro.pro:3001",Ca=async r=>{try{const t=localStorage.getItem("token");if(!(await fetch(`${wa}/orders/${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}})).ok)throw new Error("No se pudo eliminar el pedido");setOrderData(o=>o.filter(s=>s.taskid!==r))}catch(t){console.error("Error al eliminar el pedido:",t)}};function Na({open:r,message:t,handleClose:a}){return e.jsx(pr,{open:r,autoHideDuration:6e3,onClose:a,message:t})}function Ia({open:r,onClose:t,onConfirm:a,title:o,content:s}){return e.jsxs(be,{open:r,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(ye,{id:"alert-dialog-title",children:o}),e.jsx(ve,{children:e.jsx(It,{id:"alert-dialog-description",children:s})}),e.jsxs(we,{children:[e.jsx(T,{onClick:t,color:"primary",children:"Cancelar"}),e.jsx(T,{onClick:a,color:"primary",autoFocus:!0,children:"Confirmar"})]})]})}function ka({status:r}){let t;return r==="pendiente"?t="#F2CB05":r==="recibido"?t="#8BB443":t="#F25244",e.jsx(f,{children:e.jsx(yt,{sx:{color:t}})})}function Ot({open:r,onClose:t,order:a}){return a?e.jsxs(be,{open:r,onClose:t,maxWidth:"md",sx:{"& .MuiDialog-paper":{minWidth:"350px",maxWidth:"700px"}},children:[e.jsx(ye,{children:"Detalles del Producto"}),e.jsxs(ve,{children:[e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"ID del Pedido:"})," ",a.orderId]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Producto:"})," ",a.productName]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Cantidad:"})," ",a.amount]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Cantidad:"})," ",a.brand]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Fecha:"})," ",a.date]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Estado:"})," ",a.status]})}),e.jsx(f,{sx:{borderBottom:" 1px solid #f0efef",marginBottom:"1em"},children:e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Descripción:"})," ",a.details]})}),e.jsxs(f,{sx:{width:"100px",height:"100px"},children:[e.jsxs(C,{variant:"body1",children:[e.jsx("strong",{children:"Imagen:"})," "]}),e.jsx(f,{children:e.jsx("img",{src:a.image,alt:"Imagen del pedido",style:{width:"100%",height:"auto"}})})]})]}),e.jsx(we,{children:e.jsx(T,{onClick:t,color:"primary",children:"Cerrar"})})]}):null}Ot.propTypes={open:k.bool,onClose:k.func,order:k.shape({orderId:k.oneOfType([k.string,k.number]),productName:k.string,amount:k.string,brand:k.string,date:k.string,status:k.string,details:k.string,image:k.string})};function Sa(){const[r,t]=p.useState([]),[a,o]=p.useState([]),[s,l]=p.useState({}),[i,d]=p.useState(!1),[h,n]=p.useState(!1),[c,m]=p.useState(""),[j,w]=p.useState(!1),[g,b]=p.useState(null),[u,y]=p.useState(!1),[x,N]=p.useState(null),B=z(),Y=ze("(max-width:600px)");p.useEffect(()=>{P()},[]);const P=async()=>{d(!0);try{const D=await ue();!D||D.length===0?console.log("no se han encontrado proyectos"):o(D||[]);const O=await Ft();!O||O.length===0?console.log("No se han encontrado pedidos"):t(O||[])}catch(D){console.error("Error al obtener los datos:",D),m("Error al cargar los datos"),n(!0)}d(!1)},H=async()=>{if(g){try{await Ca(g),t(D=>D.filter(O=>O.orderId!==g)),m("Pedido eliminado con éxito")}catch(D){console.error("Error al eliminar el pedido:",D),m("Error al eliminar el pedido")}n(!0),M()}},S=D=>{b(D),w(!0)},M=()=>{w(!1)},V=()=>{n(!1)},ke=D=>{const O={year:"numeric",month:"numeric",day:"numeric"};return new Date(D).toLocaleDateString(void 0,O)},qt=D=>{l(O=>({...O,[D]:!O[D]}))},Ut=D=>{N(D),y(!0)},_t=()=>{y(!1),N(null)},Gt=()=>{B("/create-order")},Yt=D=>{const O=r.filter(Q=>Q.projectId===D),Vt=`Detalles de Pedidos para el Proyecto ${D}`,Kt=O.map(Q=>`
      ID del Pedido: ${Q.orderId}
      Producto: ${Q.productName}
      Fecha: ${ke(Q.date)}
      Estado: ${Q.status}
      Descripción: ${Q.description}
      Imagen: ${Q.image}
    `).join(`

`);return`mailto:destinatario@example.com?subject=${encodeURIComponent(Vt)}&body=${encodeURIComponent(Kt)}`};return i?e.jsx("p",{children:"Cargando datos de contacto..."}):e.jsx(f,{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"2em",children:e.jsxs(f,{sx:{marginTop:"2em",width:"90%"},children:[a.length>0?a.map(D=>e.jsxs(je,{elevation:2,sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",marginBottom:"2em",padding:3,backgroundColor:"#fff",":hover":{boxShadow:2}},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:2},children:[e.jsxs(C,{variant:"h6",children:[e.jsx("strong",{children:"Proyecto:"})," ",D.projectName]}),e.jsxs(T,{variant:"outlined",onClick:()=>qt(D.projectId),children:[s[D.projectId]?e.jsx(hr,{}):e.jsx(ur,{})," ","Pedidos"]})]}),e.jsx(He,{in:s[D.projectId],children:e.jsxs(f,{sx:{marginTop:"2em"},children:[r.filter(O=>O.projectId===D.projectId).length>0?r.filter(O=>O.projectId===D.projectId).map(O=>e.jsxs(je,{elevation:1,sx:{marginBottom:"1em",padding:"1em",display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:"10px",transition:"transform 0.3s, background-color 0.3s",flexDirection:Y?"column":"",":hover":{transform:"scale(1.02)",backgroundColor:"#fff",color:"#1976D2"}},children:[e.jsxs(f,{sx:{display:"flex",gap:2},children:[e.jsx(f,{sx:{display:"flex"},children:e.jsx(ka,{status:O.status})}),e.jsx(f,{sx:{display:"flex",alignItems:"center",gap:1,justifyContent:"left"},children:e.jsx(C,{variant:"body1",children:O.productName})})]}),e.jsxs(f,{sx:{display:"flex",gap:1},children:[e.jsx(A,{onClick:()=>B(`/order-details/${O.orderId}`),children:e.jsx(Re,{})}),e.jsx(A,{onClick:()=>Ut(O),children:e.jsx(kt,{})}),e.jsx(A,{onClick:()=>S(O.orderId),children:e.jsx(re,{style:{color:"red"}})})]})]},O.orderId)):e.jsx(C,{children:"No se encontraron pedidos"}),e.jsxs(f,{sx:{display:"flex",gap:2,justifyContent:"center",paddingBottom:"1em"},children:[e.jsxs(T,{onClick:()=>Gt(D.projectId),sx:{backgroundColor:"#1976d2",color:"#fff",":hover":{backgroundColor:"#fff",color:"#1976d2"}},children:["Agregar pedido ",e.jsx(de,{})]}),e.jsxs(T,{sx:{backgroundColor:"#1976d2",color:"#fff",":hover":{backgroundColor:"#fff",color:"#1976d2"}},href:Yt(D.projectId),children:["Enviar por Email ",e.jsx(xr,{})]})]})]})})]},D.projectId)):e.jsx(C,{children:"No se encontraron proyectos"}),e.jsx(Na,{open:h,message:c,handleClose:V}),e.jsx(Ia,{open:j,onClose:M,onConfirm:H,title:"Confirmar Eliminación",content:"¿Estás seguro de que deseas eliminar este pedido? Esta acción es irreversible."}),e.jsx(Ot,{open:u,onClose:_t,order:x})]})})}const Ea="https://sincro.pro:3001",Da=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${Ea}/orders/${r}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(a.ok)return await a.json();throw new Error("Failed to get order with status: "+a.status)}catch(t){throw console.error("Error al obtener la orden:",t),t}},$a="https://sincro.pro:3001",Pa=async(r,t)=>{try{const a=localStorage.getItem("token");if(!(await fetch(`${$a}/orders/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)})).ok)throw new Error("No se han podido actualizar el pedido")}catch(a){console.error("Error al hacer los cambios en pedidos-orden-materiales:",a)}};function Ta(){const r=z(),{orderId:t}=X(),[a,o]=p.useState(null),[s,l]=p.useState([]);if(p.useEffect(()=>{const d=async()=>{try{const n=await Da(t);o(n)}catch(n){console.error("Error al obtener los datos en OrderDetails:",n)}},h=async()=>{try{const n=await ue();l(n)}catch(n){console.error("Error al obtener los proyectos:",n)}};d(),h()},[t]),!a)return e.jsx("div",{children:"Loading..."});const i=Bt(a);return e.jsx(_,{initialValues:i,validationSchema:Rt,onSubmit:(d,h)=>{Pa(t,d).then(()=>{h.setSubmitting(!1),R.success("Pedido actualizado correctamente!"),r("/order-list")}).catch(n=>{console.error("Error al actualizar el pedido: ",n),h.setSubmitting(!1)})},children:({isSubmitting:d,setFieldValue:h,values:n})=>e.jsx(G,{children:e.jsx(f,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"800px",margin:"2em auto",boxShadow:3,borderRadius:"10px",backgroundColor:"#fff",transition:"transform 0.3s, box-shadow 0.3s",":hover":{transform:"scale(1.01)",boxShadow:6}},children:e.jsxs(f,{width:"90%",margin:"auto",children:[e.jsx(f,{sx:{marginBottom:"2em",borderRadius:"10px"},children:e.jsx(C,{variant:"h5",gutterBottom:!0,children:"Editar Pedido"})}),e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{name:"productName",as:te,label:"Nombre del Pedido",fullWidth:!0,InputProps:{style:{borderRadius:"10px",backgroundColor:"#fff"}},InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:12,children:e.jsxs(Ce,{fullWidth:!0,children:[e.jsx(We,{children:"Seleccionar Proyecto"}),e.jsx(v,{name:"projectName",as:oe,variant:"outlined",value:n.projectName,fullWidth:!0,onChange:c=>{const m=s.find(j=>j.name===c.target.value);h("projectName",c.target.value),h("projectId",m?m.projectId:"")},sx:{borderRadius:"10px",backgroundColor:"#fff"},children:s.map(c=>e.jsx(L,{value:c.projectName,children:c.projectName},c.projectId))})]})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{name:"amount",as:te,label:"Cantidad",fullWidth:!0,InputProps:{style:{borderRadius:"10px",backgroundColor:"#fff"}},InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{name:"brand",as:te,label:"Marca",fullWidth:!0,InputProps:{style:{borderRadius:"10px",backgroundColor:"#fff"}},InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{name:"details",as:te,label:"Detalles",fullWidth:!0,InputProps:{style:{borderRadius:"10px",backgroundColor:"#fff"}},InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{name:"provider",as:te,label:"Proveedor",fullWidth:!0,InputProps:{style:{borderRadius:"10px",backgroundColor:"#fff"}},InputLabelProps:{shrink:!0}})}),e.jsxs(E,{item:!0,xs:12,children:[e.jsx(Ke,{control:e.jsx(Je,{name:"status",checked:n.status==="pendiente",onChange:()=>h("status","pendiente")}),label:"Pendiente"}),e.jsx(Ke,{control:e.jsx(Je,{name:"status",checked:n.status==="recibido",onChange:()=>h("status","recibido")}),label:"Recibido"})]}),e.jsx(E,{item:!0,xs:12,children:e.jsx(T,{sx:{backgroundColor:"#1976d2",color:"#fff",paddingLeft:"1em",paddingRight:"1em",borderRadius:"10px",marginBottom:"2em",":hover":{backgroundColor:"#76b0a0",transform:"scale(1.02)"}},type:"submit",disabled:d,children:"Actualizar Pedido"})})]})]})})})})}const At=K().shape({contactName:I(),category:I().oneOf(["client","company","vendor","contractor","employee","other"]),company:I(),address:I(),email:I().email("Debe ser un email válido"),phone:J().typeError("Solo debe contener números, no usar letras o símbolos"),mobile:J().typeError("Solo debe contener números, no usar letras o símbolos"),comments:I()}),Fa="https://sincro.pro:3001",Ra=async r=>{const t={...r};delete t.files;try{const a=localStorage.getItem("token"),o=await fetch(`${Fa}/contacts`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(o.ok)return await o.json();throw new Error("Failed to submit form data with status: "+o.status)}catch(a){console.error("Error al enviar datos del formulario de contacto",a)}},Ba={category:"",contactName:"",company:"",address:"",email:"",phone:"",mobile:"",comments:""};function Oa(){const r=z();return e.jsx(_,{initialValues:Ba,validationSchema:At,onSubmit:(t,a)=>{Ra(t).then(()=>{a.setSubmitting(!1),a.resetForm(),R.success("Contacto creado correctamente!"),r("/allContacts")}).catch(o=>{console.error("Error en el proceso: ",o),a.setSubmitting(!1)})},children:({isSubmitting:t,setFieldValue:a,values:o,errors:s,touched:l})=>e.jsx(G,{children:e.jsx(f,{sx:{flexGrow:1,width:"100%",maxWidth:"800px",margin:"2em auto",flexDirection:"column",boxShadow:3,borderRadius:"10px",backgroundColor:"#fff",transition:"transform 0.3s, box-shadow 0.3s",":hover":{transform:"scale(1.01)",boxShadow:6}},children:e.jsx(f,{sx:{width:"90%",margin:"auto",marginTop:"3em"},children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsx(E,{item:!0,xs:12,children:e.jsxs(oe,{fullWidth:!0,name:"category",value:o.category,onChange:i=>a("category",i.target.value),displayEmpty:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}},children:[e.jsx(L,{value:"",children:e.jsx("em",{children:"Selecciona una categoría"})}),e.jsx(L,{value:"client",children:"Cliente"}),e.jsx(L,{value:"company",children:"Empresa"}),e.jsx(L,{value:"vendor",children:"Proveedor"}),e.jsx(L,{value:"contractor",children:"Subcontratista"}),e.jsx(L,{value:"employee",children:"Trabajador"}),e.jsx(L,{value:"other",children:"Otra"})]})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Nombre",name:"contactName",fullWidth:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Empresa",name:"company",fullWidth:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Dirección",name:"address",fullWidth:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Email",name:"email",fullWidth:!0,placeholder:"Ejemplo: juan@gmail.com",sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}},error:l.email&&!!s.email,helperText:e.jsx(Se,{name:"email"})})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Teléfono",name:"phone",fullWidth:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}},error:l.phone&&!!s.phone,helperText:e.jsx(Se,{name:"phone"})})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Móvil",name:"mobile",fullWidth:!0,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}},error:l.mobile&&!!s.mobile,helperText:e.jsx(Se,{name:"mobile"})})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,label:"Comentarios",name:"comments",fullWidth:!0,multiline:!0,rows:3,sx:{borderRadius:"10px",backgroundColor:"#f9f9f9","& .MuiOutlinedInput-root":{"& fieldset":{border:"none"}}}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(T,{type:"submit",variant:"contained",disabled:t,sx:{backgroundColor:"#1976d2",color:"#fff",paddingLeft:"1em",paddingRight:"1em",borderRadius:"10px",marginBottom:"2em",":hover":{backgroundColor:"#1565c0",transform:"scale(1.02)"}},children:"Crear Contacto"})})]})})})})})}const Aa="https://sincro.pro:3001",La=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${Aa}/contacts`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(t.ok)return await t.json();throw new Error("Fallo en cargar los contactos: "+t.status)}catch(r){throw console.error("Error al obtener tus contactos:",r),r}},Ma={client:{name:"Cliente"},vendor:{name:"Proveedor"},company:{name:"Empresa"},contractor:{name:"Subcontratista"},employee:{name:"Trabajador"},other:{name:"Otra"}};function za(){const[r,t]=p.useState({}),[a,o]=p.useState({}),s=z();p.useEffect(()=>{(async()=>{try{const h=(await La()).reduce((n,c)=>{const m=c.category;return n[m]||(n[m]=[]),n[m].push(c),n},{});o(h)}catch(d){console.error("Error fetching contacts:",d)}})()},[]);const l=i=>{t(d=>({...d,[i]:!d[i]}))};return e.jsxs(e.Fragment,{children:[e.jsx(f,{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:5,marginTop:"3em",children:e.jsxs(T,{variant:"outlined",onClick:()=>s("/create-contact"),sx:{backgroundColor:"#1976d2",color:"#fff",":hover":{backgroundColor:"#fff",color:"#1976d2"}},children:[e.jsx(C,{variant:"body",paddingRight:1,children:"Agregar contacto"}),e.jsx(de,{})]})}),e.jsx(f,{display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(f,{sx:{width:"90%"},children:Object.keys(a).length===0?e.jsx(C,{children:"No hay contactos disponibles"}):Object.keys(a).sort().map(i=>{var d;return e.jsxs(je,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",":hover":{boxShadow:2}},children:[e.jsxs(f,{onClick:()=>l(i),sx:{display:"flex",justifyContent:"space-between",alignItems:"center",cursor:"pointer",backgroundColor:"#fff"},children:[e.jsx(C,{variant:"h6",children:((d=Ma[i])==null?void 0:d.name)||i}),e.jsx(A,{children:r[i]?e.jsx(fr,{}):e.jsx(wt,{})})]}),e.jsx(He,{in:r[i],timeout:"auto",unmountOnExit:!0,children:e.jsx(me,{children:a[i].map(h=>e.jsxs(pe,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"1em",":hover":{backgroundColor:"#f9f9f9"}},children:[e.jsx(he,{primary:h.contactName}),e.jsx(A,{onClick:()=>s(`/contact-details/${h.contactId}`),children:e.jsx(jr,{})})]},h.contactId))})})]},i)})})})]})}const Ha="https://sincro.pro:3001",Wa=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${Ha}/contacts/${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(a.ok)return await a.json();throw new Error("Failed to get contact with status: "+a.status)}catch(t){throw console.error("Error al obtener el contacto:",t),t}},qa="https://sincro.pro:3001",Ua=async(r,t)=>{try{const a=localStorage.getItem("token");if(!(await fetch(`${qa}/contacts/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)})).ok)throw new Error("No se han podido actualizar los cambios")}catch(a){console.error("Error al hacer los cambios:",a),alert("Error al editar. Por favor, intenta de nuevo.")}},_a="https://sincro.pro:3001",Ga=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${_a}/contacts/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error("Error al eliminar el contacto: "+a.status);return{message:"Contacto eliminado exitosamente"}}catch(t){throw console.error("Error al eliminar contacto:",t),t}},tt={category:"",contactName:"",company:"",address:"",email:"",phone:"",comments:"",mobile:""};function Ya(){const{contactId:r}=X(),t=z(),[a,o]=p.useState({}),[s,l]=p.useState(tt),[i,d]=p.useState(!1);if(p.useEffect(()=>{(async()=>{d(!0);try{if(r){const m=await Wa(r),j={...m,phone:m.phone||"",email:m.email||"",mobile:m.mobile||"",address:m.address||"",comments:m.comments||""};o(j),l({...tt,...j})}}catch(m){console.error("Error fetching contacts:",m)}d(!1)})()},[r]),i)return e.jsx("p",{children:"Cargando datos de contacto..."});if(!a.contactId)return e.jsx("p",{children:"No se encontró el contacto"});const h=async c=>{try{await Ua(r,c),R.success("Datos actualizados!",{icon:"👏"})}catch{R.error("No has podido editar, intenta denuevo.")}},n=async c=>{try{await Ga(c),R.success("Contacto eliminado exitosamente!",{icon:"👏"}),t("/allcontacts")}catch{R.error("No se ha podido eliminar el contacto, intenta de nuevo.")}};return e.jsxs(f,{display:"flex",justifyContent:"center",marginTop:"2em",children:[e.jsx(ce,{}),e.jsxs(f,{sx:{display:"flex",flexDirection:"column",width:"100%",maxWidth:"600px",padding:"2em",boxShadow:3,borderRadius:"10px",backgroundColor:"#fff",transition:"transform 0.3s, box-shadow 0.3s",":hover":{transform:"scale(1.01)",boxShadow:6}},children:[e.jsx(C,{variant:"h5",sx:{marginBottom:"1em"},children:a.category}),e.jsx(C,{variant:"h5",sx:{marginBottom:"1em"},children:a.contactName}),e.jsx(_,{initialValues:s,enableReinitialize:!0,validationSchema:At,onSubmit:h,children:c=>e.jsx(G,{children:e.jsxs(E,{container:!0,spacing:3,children:[e.jsxs(E,{item:!0,xs:12,display:"flex",alignItems:"center",children:[e.jsx(v,{as:$,name:"phone",label:"Teléfono",fullWidth:!0,sx:{backgroundColor:"#f9f9f9",borderRadius:"10px"}}),c.values.phone&&e.jsx(A,{href:`tel:${c.values.phone}`,sx:{marginLeft:"0.5em"},children:e.jsx(gr,{sx:{color:"#84c7ae"}})})]}),e.jsxs(E,{item:!0,xs:12,display:"flex",alignItems:"center",children:[e.jsx(v,{as:$,name:"mobile",label:"Móvil",fullWidth:!0,sx:{backgroundColor:"#f9f9f9",borderRadius:"10px"}}),c.values.mobile&&e.jsx(A,{href:`https://wa.me/${c.values.mobile}`,sx:{marginLeft:"0.5em"},children:e.jsx(br,{sx:{color:"#84c7ae"}})})]}),e.jsxs(E,{item:!0,xs:12,display:"flex",alignItems:"center",children:[e.jsx(v,{as:$,name:"email",label:"Email",fullWidth:!0,sx:{backgroundColor:"#f9f9f9",borderRadius:"10px"}}),c.values.email&&e.jsx(A,{href:`mailto:${c.values.email}`,sx:{marginLeft:"0.5em"},children:e.jsx(yr,{sx:{color:"#84c7ae"}})})]}),e.jsxs(E,{item:!0,xs:12,display:"flex",alignItems:"center",children:[e.jsx(v,{as:$,name:"address",label:"Dirección",fullWidth:!0,sx:{backgroundColor:"#f9f9f9",borderRadius:"10px"}}),c.values.address&&e.jsx(A,{href:`https://maps.google.com/?q=${c.values.address}`,sx:{marginLeft:"0.5em"},children:e.jsx(vr,{sx:{color:"#84c7ae"}})})]}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{as:$,name:"comments",label:"Comentarios",fullWidth:!0,multiline:!0,rows:3,sx:{backgroundColor:"#f9f9f9",borderRadius:"10px"}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(T,{type:"submit",variant:"contained",sx:{backgroundColor:"#1976d2",color:"#fff",borderRadius:"10px",":hover":{backgroundColor:"#fff",color:"#1976d2"}},children:"Guardar Cambios"})})]})})}),e.jsx(T,{variant:"outlined",color:"error",sx:{marginTop:"1em"},onClick:()=>n(a.contactId),children:"Eliminar Contacto"})]})]})}const Va=K().shape({date:Z().transform((r,t)=>t?se(t,"YYYY-MM-DD").toDate():r),name:I().required(),position:I().oneOf(["Encargado","Ayudante","Principal","Becario","Otro"]),project:I(),mandatoryEquipment:I().oneOf(["Si","No","Incompleto"]),comments:I()}),Ka={date:se().format("YYYY-MM-DD"),name:"",position:"",project:"",mandatoryEquipment:"",comments:""},Ja="https://sincro.pro:3001",Xa=async r=>{const t={...r};delete t.files;try{const a=localStorage.getItem("token"),o=await fetch(`${Ja}/employees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(o.ok)return await o.json();throw new Error("Failed to submit form data with status: "+o.status)}catch(a){console.error("Error al enviar datos del formulario de empleado",a)}},Qa=window.SpeechRecognition||window.webkitSpeechRecognition,Lt=({name:r})=>{const{setFieldValue:t}=tr();lt(r);const[a,o]=p.useState(!1),s=new Qa;s.continuous=!0,s.interimResults=!0,s.lang="es-ES",s.onresult=i=>{const d=Array.from(i.results).map(h=>h[0]).map(h=>h.transcript).join("");t(r,d)};const l=()=>{a?s.stop():s.start(),o(!a)};return e.jsx(ct,{position:"end",children:e.jsx(A,{onClick:l,color:"primary",children:a?e.jsx(dt,{}):e.jsx(mt,{})})})},Za=()=>{const[r,t]=p.useState(""),[a,o]=p.useState(null);p.useEffect(()=>{(async()=>{try{const i=await ue();Array.isArray(i)&&i.length>0?o(i):(o([]),console.log("No hay proyectos creados. No se puede asignar un proyecto predeterminado."))}catch{console.error("Error al obtener los proyectos. Usando proyecto predeterminado."),o([{projectId:"default",projectName:"Default Project"}])}})()},[]);const s=l=>{t(l)};return e.jsx(_,{initialValues:Ka,validationSchema:Va,onSubmit:async(l,i)=>{try{await Xa(l),i.setSubmitting(!1),R.success("Trabajador creado correctamente"),i.resetForm()}catch(d){console.error("Error al enviar datos del formulario:",d),R.error("No se ha podido crear el trabajador")}},children:({isSubmitting:l})=>e.jsx(G,{children:e.jsx("div",{className:"container  mt-5",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"shadow p-4",children:[e.jsx("h4",{className:"text-center mb-4",children:"Crear Trabajador"}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"date",className:"form-label ms-2",children:"Fecha"}),e.jsx(v,{type:"date",name:"date",className:"form-control"})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"name",className:"form-label ms-2",children:"Nombre"}),e.jsx(v,{type:"text",name:"name",className:"form-control",placeholder:"Nombre del trabajador"})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"position",className:"form-label ms-2",children:"Posición"}),e.jsxs(v,{as:"select",name:"position",className:"form-select",children:[e.jsx("option",{value:"",children:"Seleccione una posición"}),e.jsx("option",{value:"Encargado",children:"Encargado"}),e.jsx("option",{value:"Ayudante",children:"Ayudante"}),e.jsx("option",{value:"Principal",children:"Principal"}),e.jsx("option",{value:"Becario",children:"Becario"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs("div",{className:"mb-3 text-start",children:[e.jsx("label",{htmlFor:"project",className:"form-label ms-2",children:"Obra"}),e.jsxs(v,{as:"select",name:"project",className:"form-select",children:[e.jsx("option",{value:"",children:"Seleccione un proyecto"}),a==null?void 0:a.map(i=>e.jsx("option",{value:i.projectId,children:i.projectName},i.projectId))]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"mb-3 mt-3 text-start",children:"Equipo Reglamentario Entregado"}),e.jsxs("div",{className:"d-flex justify-content-start gap-2 ",children:[e.jsx("button",{type:"button",className:`btn ${r==="Si"?"btn-success":"btn-outline-secondary"}`,onClick:()=>s("Si"),children:"SI"}),e.jsx("button",{type:"button",className:`btn ${r==="No"?"btn-danger":"btn-outline-secondary"}`,onClick:()=>s("No"),children:"NO"}),e.jsx("button",{type:"button",className:`btn ${r==="Incompleto"?"btn-warning":"btn-outline-secondary"}`,onClick:()=>s("Incompleto"),children:"Incompleto"})]})]}),e.jsxs("div",{className:"mb-3 text-start mt-4",children:[e.jsx("label",{htmlFor:"comments",className:"form-label ms-2",children:"Comentarios"}),e.jsxs("div",{className:"input-group",children:[e.jsx(v,{as:"textarea",name:"comments",className:"form-control",placeholder:"Comentarios sobre el trabajador",rows:3}),e.jsx("span",{className:"input-group-text",children:e.jsx(Lt,{name:"comments"})})]})]}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:l,children:l?"Agregando...":"Agregar Trabajador"})})]})})})})})})};function es(){const[r,t]=p.useState([]),[a,o]=p.useState(""),[s,l]=p.useState([]),i=z();p.useEffect(()=>{(async()=>{try{const c=await Ie();t(c),l(c)}catch{t([]),l([])}})()},[]);const d=n=>{o(n.target.value)},h=n=>{i(`/employee/${n}`)};return e.jsxs(e.Fragment,{children:[e.jsx(f,{marginBottom:5,display:"flex",justifyContent:"center",marginTop:"3em",width:"100%",children:e.jsxs(T,{variant:"contained",sx:{backgroundColor:"#1976d2",color:"#fff",":hover":{backgroundColor:"#fff",color:"#1976d2"}},onClick:()=>i("/create-employee"),children:[e.jsx(C,{variant:"body",paddingRight:1,children:"Agregar trabajador"}),e.jsx(de,{})]})}),e.jsx(f,{display:"flex",justifyContent:"center",width:"100%",children:e.jsxs(f,{width:"80%",display:"flex",flexDirection:"column",alignItems:"center",children:[e.jsx(Ce,{fullWidth:!0,sx:{marginBottom:"2em"},children:e.jsxs(f,{sx:{display:"flex",alignItems:"center",gap:1,marginTop:"4em",marginBottom:"2em",backgroundColor:"#fff",padding:"0.5em 1em",borderRadius:"10px"},children:[e.jsx(wr,{sx:{color:"#1976d2"}}),e.jsxs(oe,{labelId:"filter-select-label",id:"filter-select",value:a,displayEmpty:!0,onChange:d,sx:{minWidth:150,borderRadius:"10px"},renderValue:n=>n?a==="name"?"Nombre":a==="position"?"Posición":a==="project"?"Obra":"Filtrar por:":e.jsx(C,{color:"textSecondary",children:"Filtrar por:"}),children:[e.jsx(L,{value:"",disabled:!0,children:"Filtrar por:"}),e.jsx(L,{value:"name",children:"Nombre"}),e.jsx(L,{value:"position",children:"Posición"}),e.jsx(L,{value:"project",children:"Obra"})]})]})}),e.jsx(C,{variant:"h6",sx:{marginBottom:"1em"},children:"Resultados:"}),e.jsx(me,{sx:{width:"100%",paddingRight:"1em",paddingLeft:"1em"},children:s.sort((n,c)=>n.name.localeCompare(c.name)).map(n=>e.jsxs(pe,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,backgroundColor:"#fff",":hover":{boxShadow:2}},onClick:()=>h(n.employeeId),children:[e.jsx(he,{primary:a==="name"?n.name:a==="position"?`${n.position} - ${n.name}`:a==="project"?`${n.project} - ${n.name} (${n.position})`:`${n.name} - ${n.position} (${n.projectName})`}),e.jsx(A,{edge:"end","aria-label":"details",onClick:()=>h(n.employeeId),children:e.jsx(kt,{sx:{color:"#1976d2"}})})]},n.employeeId))})]})})]})}const ts="https://sincro.pro:3001",rs=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${ts}/employees/${r}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(a.ok)return await a.json();throw new Error("Failed to get employee with status: "+a.status)}catch(t){throw console.error("Error al obtener el employee:",t),t}},as="https://sincro.pro:3001",rt=async(r,t,a)=>{try{const o=localStorage.getItem("token"),s=await fetch(`${as}/hours/${r}?start=${t}&end=${a}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return await s.json()}catch(o){throw console.error("Error fetching hours worked:",o),o}},ss="https://sincro.pro:3001",os=async(r,t)=>{try{const a=localStorage.getItem("token");if(!(await fetch(`${ss}/employees/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)})).ok)throw new Error("No se han podido actualizar empleado")}catch(a){console.error("Error al hacer los cambios empleados:",a)}},ns="https://sincro.pro:3001",is=async(r,t)=>{try{const a=localStorage.getItem("token"),o=await fetch(`${ns}/hours/${r}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(t)});if(!o.ok)throw new Error("No se han podido actualizar las horas");return await o.json()}catch(a){throw console.error("Error al hacer los cambios en horas:",a),a}};function ls(){const[r,t]=p.useState(new Date);return p.useEffect(()=>{const a=setInterval(()=>{t(new Date)},1e3);return()=>clearInterval(a)},[]),e.jsx("span",{children:r.toLocaleDateString()})}const cs=r=>{let t=0,a=0,o=0,s=0;r.forEach(n=>{t+=n.regularHours,a+=n.regularMinutes||0,o+=n.extraHours||0,s+=n.extraMinutes||0}),t+=Math.floor(a/60),a=a%60,o+=Math.floor(s/60),s=s%60;const l=t+o,i=a+s,d=l+Math.floor(i/60),h=i%60;return{totalRegularHours:t,totalRegularMinutes:a,totalExtraHours:o,totalExtraMinutes:s,totalFinalHours:d,totalFinalMinutes:h}},Mt=({employee:r,hoursWorked:t,fileName:a=`${r.name}.pdf`})=>{const[o,s]=p.useState(!1),[l,i]=p.useState(""),d=()=>{s(!0)},h=()=>{s(!1)},n=()=>{const c=new qe;let m=10;if(r?(c.setFontSize(12),c.setFont("helvetica","bold"),c.text("Nombre:",10,m),c.setFont("helvetica","normal"),c.text(r.name||"N/A",40,m),m+=10,c.setFont("helvetica","bold"),c.text("Obra:",10,m),c.setFont("helvetica","normal"),c.text(r.project||"N/A",40,m),m+=10,c.setFont("helvetica","bold"),c.text("Posición:",10,m),c.setFont("helvetica","normal"),c.text(r.position||"N/A",40,m),m+=10):(c.text("Información del empleado no disponible.",10,m),m+=10),l&&(c.text(`Nota personalizada: ${l}`,10,m),m+=10),c.setFontSize(14),c.text("Horas trabajadas:",10,m),m+=10,t&&t.length>0){const j=["Fecha","Horas Regulares","Horas Extras","Total"],w=[];t.forEach(g=>{const b=[new Date(g.date).toLocaleDateString("es-ES",{weekday:"short",day:"numeric"}),`${g.regularHours.toFixed(1)}h ${g.regularMinutes}m`,`${(g.extraHours||0).toFixed(1)}h ${g.extraMinutes||0}m`,`${(g.regularHours+(g.extraHours||0)).toFixed(1)}h ${((g.regularMinutes||0)+(g.extraMinutes||0))%60}m`];w.push(b)}),Ar(c,{startY:m,head:[j],body:w,theme:"grid"})}else c.text("No se encontraron horas trabajadas en la última semana.",10,m),m+=10;c.save(a),s(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{type:"button",onClick:d,variant:"contained",style:{backgroundColor:"#1976d2"},"aria-label":"Create PDF",children:"Crear PDF del Empleado"}),e.jsxs(be,{open:o,onClose:h,children:[e.jsx(ye,{children:"Añadir Nota Personalizada"}),e.jsx(ve,{children:e.jsx($,{autoFocus:!0,margin:"dense",id:"customText",label:"Nota Personalizada",type:"text",fullWidth:!0,variant:"standard",value:l,onChange:c=>i(c.target.value)})}),e.jsxs(we,{children:[e.jsx(T,{onClick:h,children:"Cancelar"}),e.jsx(T,{onClick:n,children:"Generar PDF"})]})]})]})};Mt.propTypes={employee:k.shape({name:k.string,project:k.string,position:k.string}),hoursWorked:k.arrayOf(k.shape({date:k.string.isRequired,regularHours:k.number.isRequired,regularMinutes:k.number.isRequired,extraHours:k.number,extraMinutes:k.number})),fileName:k.string};const ds=K().shape({date:Z().required("La fecha es obligatoria"),regularHours:J().min(0,"Las horas no pueden ser negativas").max(10,"Las horas regulares no pueden ser mayor a 10 por día"),regularMinutes:J().min(0,"Los minutos no pueden ser negativos").max(59,"Los minutos no pueden exceder de 59"),extraHours:J().min(0,"Las horas extras no pueden ser negativas"),extraMinutes:J().min(0,"Los minutos extras no pueden ser negativos").max(59,"Los minutos extras no pueden exceder de 59")}),ms=K({mandatoryEquipment:I().oneOf(["Si","No","Incompleto"],"Opción no válida").required("El equipo entregado es obligatorio"),comments:I().required("Los comentarios son obligatorios")});function ps(){const{employeeId:r}=X(),[t,a]=p.useState(null),[o,s]=p.useState(""),[l,i]=p.useState(""),[d,h]=p.useState([]);ze("(max-width:600px)"),p.useEffect(()=>{r&&(async()=>{try{const g=await rs(r);g&&g.length>0?a(g[0]):console.error("No se encontró el empleado")}catch(g){console.error("Fallo al obtener el trabajador, página employee fetch/useEffect",g)}})();const m=new Date().toISOString().split("T")[0],j=new Date;j.setDate(j.getDate()-7),i(m),s(j.toISOString().split("T")[0]),(async()=>{try{const g=await rt(r,j.toISOString().split("T")[0],m);h(g)}catch(g){console.error("Failed to fetch hours worked",g),h([])}})()},[r]);const n=async()=>{try{const m=(await rt(r,o,l)).map(j=>({...j,regularMinutes:j.regularMinutes||0,extraMinutes:j.extraMinutes||0}));h(m)}catch{h([])}};return t?e.jsxs(f,{sx:{width:"90%"},children:[e.jsx(ce,{}),e.jsxs(f,{sx:{width:"90%",margin:"2em auto",backgroundColor:"#fff",padding:"2em",borderRadius:"10px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(C,{variant:"h6",textAlign:"left",children:"Información del trabajador"}),e.jsxs(C,{sx:{textAlign:"left"},variant:"subtitle1",children:[e.jsx("strong",{children:"Nombre: "}),t.name]}),e.jsxs(C,{sx:{textAlign:"left"},variant:"subtitle1",children:[e.jsx("strong",{children:"Obra: "}),t.project]}),e.jsxs(C,{sx:{textAlign:"left"},variant:"subtitle1",children:[e.jsx("strong",{children:"Posición: "}),t.position]})]}),e.jsx(_,{initialValues:{mandatoryEquipment:t.mandatoryEquipment||"",comments:t.comments||""},enableReinitialize:!0,validationSchema:ms,onSubmit:async(c,{setSubmitting:m})=>{try{await os(r,{mandatoryEquipment:c.mandatoryEquipment,comments:c.comments}),R.success("Información del trabajador actualizada exitosamente!")}catch(j){console.error("Failed to update employee information",j),R.error("Error al ingresar la información.")}finally{m(!1)}},children:({isSubmitting:c,errors:m,touched:j})=>e.jsx(G,{children:e.jsxs(f,{sx:{width:"90%",margin:"0 auto",backgroundColor:"#fff",padding:"2em",borderRadius:"10px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsxs(Ce,{fullWidth:!0,margin:"normal",sx:{backgroundColor:"#fff"},children:[e.jsx(We,{children:"Equipo entregado"}),e.jsxs(v,{as:oe,name:"mandatoryEquipment",error:j.mandatoryEquipment&&!!m.mandatoryEquipment,children:[e.jsx(L,{value:"",children:"Seleccione"}),e.jsx(L,{value:"Si",children:"Si"}),e.jsx(L,{value:"No",children:"No"}),e.jsx(L,{value:"Incompleto",children:"Incompleto"})]}),j.mandatoryEquipment&&m.mandatoryEquipment&&e.jsx(C,{color:"error",children:m.mandatoryEquipment})]}),e.jsx(v,{as:$,name:"comments",label:"Comentarios",fullWidth:!0,margin:"normal",sx:{backgroundColor:"#fff"},error:j.comments&&!!m.comments,helperText:j.comments&&m.comments}),e.jsx(f,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{sx:{marginTop:"1em",marginBottom:"1em",color:"#1976D2",borderRadius:"10px",":hover":{backgroundColor:"#fff",color:"#1976d2"}},type:"submit",disabled:c,variant:"outlined",children:"Editar Información"})})]})})}),e.jsx(_,{initialValues:{date:new Date().toISOString().split("T")[0],regularHours:0,regularMinutes:0,extraHours:0,extraMinutes:0},validationSchema:ds,onSubmit:async(c,{setSubmitting:m})=>{m(!1);try{await is(r,{date:new Date().toISOString().split("T")[0],regularHours:c.regularHours,regularMinutes:c.regularMinutes,extraHours:c.extraHours,extraMinutes:c.extraMinutes}),R.success("Horas trabajadas agregadas exitosamente.")}catch(j){console.error("Failed to update hours worked",j),R.error("Error al actualizar las horas trabajadas.")}finally{m(!1)}},children:({isSubmitting:c,errors:m,touched:j})=>e.jsx(G,{children:e.jsxs(f,{sx:{width:"90%",margin:"2em auto",backgroundColor:"#fff",padding:"2em",borderRadius:"10px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)"},children:[e.jsx(C,{variant:"h6",textAlign:"left",children:"Horas trabajadas"}),e.jsxs(C,{textAlign:"left",children:[e.jsx("strong",{children:"Fecha:"})," ",e.jsx(ls,{})]}),e.jsx(C,{textAlign:"left",marginBottom:"2em",children:"Introducir horas trabajadas"}),e.jsxs(f,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",marginBottom:"1em",children:[e.jsx(v,{as:$,name:"regularHours",label:"Horas regulares",placeholder:"0",margin:"normal",error:j.regularHours&&!!m.regularHours,helperText:j.regularHours&&m.regularHours,sx:{flex:"0 0 48%",backgroundColor:"#fff"}}),e.jsx(v,{as:$,name:"regularMinutes",label:"Minutos regulares",placeholder:"0",margin:"normal",error:j.regularMinutes&&!!m.regularMinutes,helperText:j.regularMinutes&&m.regularMinutes,sx:{flex:"0 0 48%",backgroundColor:"#fff"}}),e.jsx(v,{as:$,name:"extraHours",label:"Horas extra",placeholder:"0",margin:"normal",error:j.extraHours&&!!m.extraHours,helperText:j.extraHours&&m.extraHours,sx:{flex:"0 0 48%",backgroundColor:"#fff"}}),e.jsx(v,{as:$,name:"extraMinutes",label:"Minutos Extra",placeholder:"0",margin:"normal",error:j.extraMinutes&&!!m.extraMinutes,helperText:j.extraMinutes&&m.extraMinutes,sx:{flex:"0 0 48%",backgroundColor:"#fff"}})]}),e.jsx(f,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{sx:{color:"#1976D2",borderRadius:"10px",":hover":{backgroundColor:"#1565c0",transform:"scale(1.02)",color:"#fff"}},type:"submit",disabled:c,variant:"outlined",children:"Agregar horas"})})]})})}),e.jsxs(f,{sx:{marginTop:"2em",backgroundColor:"#fff",width:"90%",margin:"2em auto",padding:"2em",borderRadius:"10px",boxShadow:3},children:[e.jsx(C,{variant:"h6",textAlign:"left",marginBottom:"2em",children:"Consultar Horas Trabajadas"}),e.jsx($,{label:"Desde",type:"date",value:o,onChange:c=>s(c.target.value),sx:{marginRight:2,marginBottom:2},InputLabelProps:{shrink:!0}}),e.jsx($,{label:"Hasta",type:"date",value:l,sx:{marginRight:2,marginBottom:2},onChange:c=>i(c.target.value),InputLabelProps:{shrink:!0}}),e.jsx(f,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(T,{variant:"outlined",color:"primary",onClick:n,sx:{color:"#1976d2",borderRadius:"10px",":hover":{backgroundColor:"#1565c0",transform:"scale(1.02)",color:"#fff"}},children:"Consultar"})}),d.length>0&&e.jsx(zt,{hoursWorked:d})]}),t&&e.jsx(Mt,{employee:t,hoursWorked:d})]}):e.jsx(C,{children:"Cargando..."})}const zt=({hoursWorked:r})=>{const t=cs(r);return e.jsxs(f,{children:[e.jsx(C,{variant:"h6",gutterBottom:!0,children:"Horas Trabajadas"}),e.jsx(Cr,{component:je,children:e.jsxs(Nr,{children:[e.jsx(Ir,{children:e.jsxs(De,{children:[e.jsx(q,{children:"Fecha"}),e.jsx(q,{align:"right",children:"Horas Regulares"}),e.jsx(q,{align:"right",children:"Horas Extras"}),e.jsx(q,{align:"right",children:"Total"})]})}),e.jsxs(kr,{children:[r.map((a,o)=>e.jsxs(De,{children:[e.jsx(q,{component:"th",scope:"row",children:new Date(a.date).toLocaleDateString("es-ES",{weekday:"short",day:"numeric"})}),e.jsxs(q,{align:"right",children:[a.regularHours.toFixed(1),"h ",a.regularMinutes||0,"m"]}),e.jsxs(q,{align:"right",children:[(a.extraHours||0).toFixed(1),"h"," ",a.extraMinutes||0,"m"]}),e.jsxs(q,{align:"right",children:[(a.regularHours+(a.extraHours||0)).toFixed(1),"h"," ",((a.regularMinutes||0)+(a.extraMinutes||0))%60,"m"]})]},o)),e.jsxs(De,{children:[e.jsx(q,{component:"th",scope:"row",children:e.jsx("strong",{children:"Total"})}),e.jsx(q,{align:"right",children:e.jsxs("strong",{children:[t.totalRegularHours.toFixed(1),"h"," ",t.totalRegularMinutes,"m"]})}),e.jsx(q,{align:"right",children:e.jsxs("strong",{children:[t.totalExtraHours.toFixed(1),"h"," ",t.totalExtraMinutes,"m"]})}),e.jsx(q,{align:"right",children:e.jsxs("strong",{children:[t.totalFinalHours.toFixed(1),"h"," ",t.totalFinalMinutes,"m"]})})]})]})]})}),e.jsx(f,{sx:{display:"flex",justifyContent:"flex-end",marginTop:"1em"}})]})};zt.propTypes={hoursWorked:k.arrayOf(k.shape({date:k.string.isRequired,regularHours:k.number,regularMinutes:k.number,extraHours:k.number,extraMinutes:k.number})).isRequired};const hs="https://sincro.pro:3001",us=async()=>{try{const r=localStorage.getItem("token"),t=await fetch(`${hs}/projects/reports/all`,{method:"GET",headers:{Authorization:`Bearer ${r}`}});if(t.ok)return await t.json();throw new Error("Fallo en cargar los proyectos: "+t.status)}catch(r){throw console.error("Error al obtener tus proyectos:",r),r}},xs="https://sincro.pro:3001",fs=async(r,t)=>{try{const a=localStorage.getItem("token"),o=await fetch(`${xs}/projects/${r}/reports/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${a}`}});if(!o.ok)throw new Error("Fallo en eliminar el reporte: "+o.status)}catch(a){throw console.error("Error al eliminar el reporte:",a),a}},js=()=>{const[r,t]=p.useState([]),a=p.useCallback(async()=>{try{const i=await us();t(i)}catch(i){console.error("Error fetching reports:",i)}},[]),o=async(i,d)=>{try{await fs(i,d),a()}catch(h){console.error("Error deleting report:",h)}},s=i=>{const d=r.find(h=>h.id===i);if(d){const h=d.url,n={title:"Reporte",text:"Mira este reporte",url:h};if(navigator.share)navigator.share(n).then(()=>{}).catch(c=>{console.error("Error al compartir:",c)});else{const c=`Mira este reporte: ${d.original_filename}`,m=`Puedes ver el reporte en el siguiente enlace: ${h}`,j=`mailto:?subject=${encodeURIComponent(c)}&body=${encodeURIComponent(m)}`;window.location.href=j}}};p.useEffect(()=>{a()},[a]);const l=i=>decodeURIComponent(i).replace(/^\d+-/,"").replace(/_/g," ").replace(/-/g," ");return e.jsxs(e.Fragment,{children:[e.jsxs(C,{variant:"h5",sx:{marginTop:"2em"},children:[" ","Lista de Reportes creados en PDF"]}),e.jsx(me,{children:r.map(i=>e.jsx(f,{sx:{boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)",borderRadius:"5px",padding:3,marginTop:"2em",backgroundColor:"#fff",":hover":{boxShadow:2}},children:e.jsxs(pe,{children:[e.jsx(he,{primary:e.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",download:l(i.original_filename),children:l(i.original_filename)})}),e.jsx(A,{edge:"end","aria-label":"delete",onClick:()=>o(i.projectId,i.id),children:e.jsx(Sr,{sx:{color:"red",marginRight:".5em"}})}),e.jsx(A,{edge:"end","aria-label":"share",onClick:()=>s(i.id),children:e.jsx(Er,{})})]},i.id)},i.id))})]})};function gs(){const r=st(),a=[{path:"/login",title:""},{path:"/home",title:"Home"},{path:"/create-new-project",title:"Nuevo Proyecto"},{path:"/my-projects",title:"Mis Proyectos"},{path:"/project-info/:projectId",title:"Información del Proyecto"},{path:"/project-edit-info/:projectId",title:"Editar Proyecto"},{path:"/project-info-data/:projectId",title:"Información del proyecto"},{path:"/project-section-tasks",title:"Tareas por sección"},{path:"/project-create-task/:projectId/:sectionKey",title:"Crear tarea"},{path:"/project-info-task/:sectionKey",title:"Tarea"},{path:"/edit-task/:taskId",title:"Mi Tarea"},{path:"/pendings",title:"Mis pendientes"},{path:"/progress",title:"Avances de Proyecto"},{path:"/order-list",title:"Pedidos de Material"},{path:"/order-details/:orderId",title:"Detalles del pedido"},{path:"/create-order",title:"Crear Pedido"},{path:"/allContacts",title:"Contactos"},{path:"/create-contact",title:"Crear contacto nuevo"},{path:"/staff-list",title:"Lista de trabajadores"},{path:"/create-employee",title:"Crear Trabajador"},{path:"/employee",title:"Detalles del trabajador"},{path:"/reports",title:"Reporte"}].find(o=>Lr({path:o.path,end:!1},r.pathname));return a?a.title:"PÁGINA NO ENCONTRADA"}function bs(){const[r,t]=p.useState(!1),a=s=>l=>{l.type==="keydown"&&(l.key==="Tab"||l.key==="Shift")||t(s)},o=()=>e.jsx("div",{role:"presentation",onClick:a(!1),onKeyDown:a(!1),children:e.jsx(me,{children:e.jsx(f,{sx:{backgroundColor:"#fff",paddingRight:"2em"},children:Ue.map((s,l)=>e.jsxs(pe,{component:ae,to:s.path,sx:{borderRadius:"5px",transition:"transform 0.2s, box-shadow 0.2s",cursor:"pointer","&:hover":{transform:"scale(1.02)",boxShadow:"0px 4px 8px rgba(0, 0, 0, 0.1)"}},children:[e.jsx(vt,{children:s.icon}),e.jsx(he,{primary:s.name})]},l))})})});return e.jsxs(e.Fragment,{children:[e.jsx(A,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:a(!0),sx:{mr:2},children:e.jsx(Dr,{})}),e.jsx(Ct,{anchor:"left",open:r,onClose:a(!1),children:o()})]})}function ys(){const r=gs();return z(),st(),e.jsxs(e.Fragment,{children:["s",e.jsx($r,{position:"fixed",sx:{backgroundColor:"#1976d2",cursor:"pointer"},children:e.jsxs(Nt,{variant:"dense",children:[e.jsx(bs,{}),e.jsx(C,{variant:"h6",color:"inherit",component:"div",children:r})]})}),e.jsx(f,{children:e.jsx(ot,{})})]})}const vs=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{5,}$/,ws=K().shape({email:I().email("Invalid email").required("Email Required"),password:I().matches(vs,{message:"Incorrect Password"}).required("Password required")}),Cs=()=>{const{login:r}=Ne(),t=z(),a=Le({initialValues:{email:"",password:""},validationSchema:ws,onSubmit:async o=>{try{await r(o.email,o.password),t("/home")}catch(s){console.error("Error logging in:",s)}}});return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{height:"100vh"},children:e.jsxs("div",{className:"card shadow",style:{maxWidth:"400px",width:"100%",padding:"2em"},children:[e.jsx("h2",{className:"text-primary text-center mb-4",children:"Iniciar Sesión"}),e.jsxs("form",{onSubmit:a.handleSubmit,children:[e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"email",children:"Ingrese su email"}),e.jsx("input",{type:"email",id:"email",name:"email",className:`form-control ${a.errors.email&&a.touched.email?"is-invalid":""}`,value:a.values.email,onChange:a.handleChange,onBlur:a.handleBlur}),a.errors.email&&a.touched.email&&e.jsx("div",{className:"invalid-feedback",children:a.errors.email})]}),e.jsxs("div",{className:"form-group mb-3",children:[e.jsx("label",{htmlFor:"password",children:"Ingrese su contraseña"}),e.jsx("input",{type:"password",id:"password",name:"password",className:`form-control ${a.errors.password&&a.touched.password?"is-invalid":""}`,value:a.values.password,onChange:a.handleChange,onBlur:a.handleBlur}),a.errors.password&&a.touched.password&&e.jsx("div",{className:"invalid-feedback",children:a.errors.password})]}),e.jsx("div",{className:"d-grid mb-3",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a.isSubmitting,children:"Iniciar sesión"})}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"mb-1",children:["¿No tienes una cuenta?",e.jsx(ae,{to:"/register",className:"text-primary ms-1",children:"Regístrate"})]}),e.jsxs("p",{className:"mb-1",children:["¿Olvidaste tu contraseña?",e.jsx(ae,{to:"/forgot-password",className:"text-primary ms-1",children:"Haz click aquí para recuperarla"})]})]})]})]})})},Ns=/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{5,}$/,Is=K().shape({name:I().required("El nombre es obligatorio"),surname:I(),company:I(),email:I().email("Invalid email").required("El Email es obligatorio "),password:I().matches(Ns,{message:"La contraseña debe contener //min 5 caracteres, 1 mayúscula, 1 minúscula, 1 número"}).required("Contraseña requerida"),confirmPassword:I().oneOf([Fe("password"),null],"Las contraseñas deben coincidir").required("Confirmar contraseña es obligatorio")}),ks="https://sincro.pro:3001",Ss=async(r,t,a)=>{try{const o=await fetch(`${ks}/users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(o.ok)R.success("Te has registrado correctamente, inicia sesión para entrar!"),a("/login");else{const s=await o.json();o.status===409?t.setFieldError("email","Este email ya está registrado. Usa otro o inicia sesión."):(console.error("Error en el registro",s),t.setFieldError("general",s.message||"Error en el registro"))}t.setSubmitting(!1),t.resetForm()}catch(o){console.error("Error de conexión:",o),t.setFieldError("general","No se puede conectar al servidor"),t.setSubmitting(!1)}},Es=()=>{const r=z(),t=Le({initialValues:{name:"",surname:"",email:"",company:"",password:"",confirmPassword:""},validationSchema:Is,onSubmit:async(a,o)=>{try{await Ss(a,o,r),r("/login")}catch(s){console.error("Error registering:",s)}}});return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{height:"100vh"},children:e.jsxs("div",{className:"card shadow",style:{maxWidth:"400px",width:"100%",padding:"1em"},children:[e.jsx("h2",{className:"text-primary text-center mb-4",children:"Regístrate"}),e.jsxs("form",{onSubmit:t.handleSubmit,children:[e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"name",style:{marginLeft:"10px"},children:"Nombre"}),e.jsx("input",{type:"text",id:"name",name:"name",className:`form-control ${t.errors.name&&t.touched.name?"is-invalid":""}`,value:t.values.name,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.name&&t.touched.name&&e.jsx("div",{className:"invalid-feedback",children:t.errors.name})]}),e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"surname",style:{marginLeft:"10px"},children:"Apellido"}),e.jsx("input",{type:"text",id:"surname",name:"surname",className:`form-control ${t.errors.surname&&t.touched.surname?"is-invalid":""}`,value:t.values.surname,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.surname&&t.touched.surname&&e.jsx("div",{className:"invalid-feedback",children:t.errors.surname})]}),e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"company",style:{marginLeft:"10px"},children:"Empresa"}),e.jsx("input",{type:"text",id:"company",name:"company",className:`form-control ${t.errors.company&&t.touched.company?"is-invalid":""}`,value:t.values.company,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.company&&t.touched.company&&e.jsx("div",{className:"invalid-feedback",children:t.errors.company})]}),e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"email ",style:{marginLeft:"10px"},children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",className:`form-control ${t.errors.email&&t.touched.email?"is-invalid":""}`,value:t.values.email,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.email&&t.touched.email&&e.jsx("div",{className:"invalid-feedback",children:t.errors.email})]}),e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"password",style:{marginLeft:"10px"},children:"Contraseña"}),e.jsx("input",{type:"password",id:"password",name:"password",className:`form-control ${t.errors.password&&t.touched.password?"is-invalid":""}`,value:t.values.password,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.password&&t.touched.password&&e.jsx("div",{className:"invalid-feedback",children:t.errors.password})]}),e.jsxs("div",{className:"form-group mb-3 text-start",children:[e.jsx("label",{htmlFor:"confirmPassword",style:{marginLeft:"10px"},children:"Confirmar Contraseña"}),e.jsx("input",{type:"password",id:"confirmPassword",name:"confirmPassword",className:`form-control ${t.errors.confirmPassword&&t.touched.confirmPassword?"is-invalid":""}`,value:t.values.confirmPassword,onChange:t.handleChange,onBlur:t.handleBlur}),t.errors.confirmPassword&&t.touched.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:t.errors.confirmPassword})]}),e.jsx("div",{className:"d-grid mb-3 text-start m",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:t.isSubmitting,children:"Registrarse"})}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"mb-1",children:["¿Ya tienes una cuenta?",e.jsx(ae,{to:"/login",className:"text-primary ms-1",children:"Inicia sesión"})]})})]})]})})};function Ds(){const{logout:r}=Ne(),t=()=>{r()};return e.jsxs("div",{className:"container-wrapper ",children:[e.jsx("div",{children:e.jsx("h2",{className:"mb-5",children:"¿Qué quieres hacer hoy? "})}),e.jsx("div",{className:"grid-container",children:Ue.map((a,o)=>e.jsx("div",{className:"grid-item",children:e.jsx("div",{className:"card shadow-sm text-center",style:{cursor:"pointer"},onClick:a.name==="Salir"?t:null,children:e.jsx(ae,{to:a.name==="Salir"?"#":a.path,className:"text-decoration-none text-dark",children:e.jsxs("div",{className:"card-body",children:[a.icon,e.jsx("h5",{className:"mt-3",children:a.name})]})})})},o))})]})}const $s=({uploadedImg:r,className:t,...a})=>{const s=new Wr({cloud:{cloudName:"dcmnj8rrj"}}).image(r),[l,i]=p.useState(!1),d=()=>{i(!l)};return e.jsx(f,{sx:{position:"relative",display:"inline-block",border:"1px solid #ccc",borderRadius:"10px",margin:"5px",cursor:"pointer",transition:"width 0.3s ease, height 0.3s ease",width:l?"400px":"100px",height:l?"400px":"100px"},onClick:d,children:e.jsx(Mr,{...a,className:t,cldImg:s,plugins:[zr(),Hr({mode:"blur"})],style:{width:"100%",height:"100%"}})})};function Ps(){const{projectId:r,sectionKey:t}=X(),a=z(),[o,s]=p.useState(null),[l,i]=p.useState([]);return p.useEffect(()=>{r&&ne(r).then(d=>{s(d),d&&d.sections&&d.sections[t]&&_e(r,t).then(h=>{i(h)})}).catch(d=>{console.error("Error fetching project data:",d)})},[r,t]),o?!o.sections||!o.sections[t]?e.jsx("div",{children:"La sección especificada no existe en este proyecto."}):l.length===0?e.jsxs(f,{children:[e.jsx(C,{children:"No hay tareas para esta sección."}),e.jsx(Re,{onClick:()=>a("/create-task"),style:{cursor:"pointer",color:"blue"}})]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{marginBottom:5,children:e.jsxs(T,{variant:"outlined",sx:{border:"1px solid #fff"},onClick:()=>a(`/project-create-task/${r}/${t}`),children:[e.jsxs(C,{variant:"body",color:"#000",paddingRight:1,children:["Agregar tarea"," "]}),e.jsx(de,{sx:{color:"#fff"}})]})}),e.jsxs(f,{display:"flex",justifyContent:"space-evenly",children:[e.jsxs(f,{padding:"2em",borderRadius:"10px",children:[e.jsx(ge,{})," "]}),e.jsxs(f,{backgroundColor:"#ffffff4d",padding:"2em",borderRadius:"10px",children:[e.jsxs(f,{marginBottom:"2em",children:[e.jsx(C,{variant:"body",children:o.projectName}),e.jsx(C,{variant:"body",sx:{mx:1},children:o.constructionType}),e.jsx(C,{variant:"body",children:"Tareas: "}),e.jsxs(C,{variant:"h6",children:["Sección:"," ",t.charAt(0).toUpperCase()+t.slice(1)]})]}),e.jsx(f,{children:l.filter(d=>d.sectionKey===t).map(d=>e.jsxs(f,{sx:{display:"flex",flexDirection:"column",marginTop:"2em",justifyContent:"space-around",marginBottom:"2em",boxShadow:"1px 1px 1px #ccc",borderRadius:"10px"},children:[e.jsxs(f,{sx:{display:"flex",justifyContent:"space-around"},children:[e.jsxs(f,{sx:{display:"flex"},children:[e.jsx(Ye,{}),e.jsx(C,{variant:"h6",sx:{marginLeft:"1em"},children:d.taskName})]}),e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between"},children:[e.jsx(Re,{onClick:()=>a(`/edit-task/${d.taskId}`),style:{cursor:"pointer"}}),e.jsx(re,{sx:{marginLeft:"1em",color:"red"},onClick:()=>$t(d.taskId),style:{cursor:"pointer"}})]})]}),e.jsx(f,{sx:{display:"flex",flexWrap:"wrap"},children:d.prevImages&&d.prevImages.map((h,n)=>e.jsx($s,{uploadedImg:h,alt:`Preview ${n}`,className:"prueba"},n))}),e.jsx(f,{sx:{display:"flex",flexWrap:"wrap"},children:d.finalImages&&d.finalImages.map((h,n)=>e.jsx("img",{src:h,alt:`Final ${n}`,style:{maxWidth:"100px",margin:"5px"}},n))})]},d.taskId))}),e.jsx(A,{onClick:()=>a(`/project-create-task/${r}/${t}`)})]})]})]}):e.jsx("div",{children:"Cargando datos del proyecto..."})}const Ht=K().shape({taskName:I().required("El nombre de la tarea es obligatorio"),employeeId:J(),employeeName:I(),projectId:J(),sectionKey:I(),taskDescription:I(),startDate:Z().max(Fe("endDate"),"La fecha de inicio debe ser antes de la fecha de entrega"),endDate:Z().min(Fe("startDate"),"La fecha de entrega debe ser después de la fecha de inicio"),status:I().oneOf(["noIniciado","iniciado","terminado"]),prevImages:Te().of(I().url()),finalImages:Te().of(I().url())}),Ts="https://sincro.pro:3001",Fs=async(r,t)=>{try{const a=localStorage.getItem("token"),o=await fetch(`${Ts}/tasks/${t}`,{method:"POST",headers:{Authorization:`Bearer ${a}`},body:r});if(o.ok)return await o.json();throw new Error("Failed to submit form data with status: "+o.status)}catch(a){console.error("Error al enviar datos del formulario",a)}},Ae=(r={})=>({taskName:(r==null?void 0:r.taskName)||"",employeeId:(r==null?void 0:r.employeeId)||"",employeeName:(r==null?void 0:r.employeeName)||"",taskDescription:(r==null?void 0:r.taskDescription)||"",projectId:(r==null?void 0:r.projectId)||"",sectionKey:r.sectionKey||"",startDate:(r==null?void 0:r.startDate)||se().format("YYYY-MM-DD"),endDate:(r==null?void 0:r.endDate)||se().format("YYYY-MM-DD"),status:(r==null?void 0:r.status)||"noIniciado",prevImages:(r==null?void 0:r.prevImages)||[],finalImages:(r==null?void 0:r.finalImages)||[]});function Rs(){const{projectId:r,sectionKey:t}=X(),a=z(),[o,s]=p.useState([]),[l,i]=p.useState(null),[d,h]=p.useState([]),[n,c]=p.useState([]);p.useEffect(()=>{(async()=>{if(r)try{const w=await ne(r);i(w)}catch(w){console.error("Error al obtener los datos del proyecto:",w)}try{const w=await Ie();s(w)}catch(w){console.error("Error al obtener los datos de los trabajadores:",w)}})()},[r]);const m=(j,w)=>{const g=Array.from(j.target.files);w(b=>{const u=g.filter(y=>!b.some(x=>x.name===y.name));return[...b,...u]})};return l?e.jsxs(f,{children:[e.jsx(f,{sx:{marginTop:"3em"},children:e.jsxs("div",{children:[l.projectName," "," - "," ",l.constructionType," - ",t]})}),e.jsx(_,{initialValues:Ae(),validationSchema:Ht,onSubmit:async(j,w)=>{const g=new FormData;g.append("projectId",r),g.append("taskName",j.taskName),g.append("employeeId",j.employeeId),g.append("employeeName",j.employeeName),g.append("taskDescription",j.taskDescription),g.append("startDate",j.startDate),g.append("endDate",j.endDate),d.forEach(b=>{g.append("prevImages",b)}),n.forEach(b=>{g.append("finalImages",b)}),g.forEach((b,u)=>{});try{await Fs(g,t),R.success("Tarea creada con éxito!"),a(-1)}catch(b){console.error("Error durante el proceso de creación de tarea: ",b),R.error("Error al crear la tarea"),w.setSubmitting(!1)}},children:({isSubmitting:j,setFieldValue:w,values:g})=>e.jsx(G,{children:e.jsx(f,{sx:{maxWidth:800,margin:"2em auto",backgroundColor:"#EDF5F4",padding:"2em",display:"flex",borderRadius:"10px"},children:e.jsxs(E,{container:!0,spacing:1,children:[e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{sx:{backgroundColor:"#fff"},as:$,name:"taskName",label:"Nombre de la tarea",fullWidth:!0})}),e.jsx(E,{item:!0,xs:12,children:e.jsxs(v,{as:oe,name:"employeeId",value:g.employeeId||"",sx:{backgroundColor:"#fff",marginTop:".5em"},fullWidth:!0,displayEmpty:!0,onChange:b=>{const u=b.target.value,y=o.find(N=>N.employeeId===u),x=y?y.name:"";w("employeeId",u),w("employeeName",x)},children:[e.jsx(L,{value:"",children:e.jsx("em",{children:"Selecciona a un trabajador"})}),o.map(b=>e.jsx(L,{value:b.employeeId,children:b.name},b.employeeId))]})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(v,{sx:{backgroundColor:"#fff",marginTop:".5em"},as:$,name:"taskDescription",label:"Descripción de la tarea",multiline:!0,fullWidth:!0,InputProps:{endAdornment:e.jsx(Lt,{name:"taskDescription"})}})}),e.jsx(E,{item:!0,xs:6,children:e.jsx(v,{sx:{backgroundColor:"#fff",marginTop:"2em",marginBottom:"2em"},as:$,name:"startDate",label:"Fecha de inicio",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:6,children:e.jsx(v,{sx:{backgroundColor:"#fff",marginTop:"2em",marginBottom:"2em"},as:$,name:"endDate",label:"Fecha de entrega",type:"date",fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(E,{item:!0,xs:12,children:e.jsx("input",{type:"file",name:"prevImages",onChange:b=>m(b,h),multiple:!0})}),e.jsx(E,{item:!0,xs:12,children:e.jsx("input",{type:"file",name:"finalImages",onChange:b=>m(b,c),multiple:!0})}),e.jsx(E,{item:!0,xs:12,children:e.jsx(T,{type:"submit",disabled:j,sx:{backgroundColor:"#1976d2",color:"#fff",marginTop:"2em"},children:"Crear Tarea"})})]})})})}),e.jsx(ce,{position:"top-right",reverseOrder:!1})]}):e.jsx("div",{children:"Loading..."})}const Bs="https://sincro.pro:3001",Os=async(r,t)=>{try{const a=localStorage.getItem("token"),o=await fetch(`${Bs}/projects/${r}`,{method:"PATCH",headers:{Authorization:`Bearer ${a}`},body:t});if(!o.ok){const l=await o.json();throw new Error(l.message||"No se han podido actualizar los cambios.")}const s=await o.json();return{ok:o.ok,responseData:s}}catch(a){throw console.error("Error al hacer los cambios:",a),a}};function ie(r){switch(r){case"hiringCompany":return"Empresa Contratante";case"projectName":return"Nombre del proyecto";case"identifier":return"Identificador";case"address":return" Detalle de Dirección";case"block":return"Bloque";case"unit":return"Unidad";case"addressDescription":return"Detalle de dirección";case"zipCode":return"Código Postal";case"province":return"Provincia";case"typeOfWork":return"Tipo de trabajo";case"constructionType":return"Tipo de construcción";case"map":return"Mapa";case"startDate":return"Fecha de Inicio";case"endDate":return"Fecha de entrega";case"projectDescription":return" Descripción del Proyecto";case"taskDescription":return"Detalles de la tarea";case"sections":return"Secciones a trabajar";case"status":return"Estado"}}function As(){const{projectId:r}=X(),[t,a]=p.useState(Oe),[o,s]=p.useState(null),[l,i]=p.useState(!0),[d,h]=p.useState(""),[n,c]=p.useState(""),m=z();p.useEffect(()=>{r&&ne(r).then(g=>{if(g){const b=Object.fromEntries(Object.entries(g).map(([u,y])=>[u,y||""]));a({...Oe,...b}),s(b),c(b.image)}else console.error("Error, si esto se muestra es porque no se pudieron traer los datos del getProjectById Frontend")}).catch(g=>{console.error("Error si esto se muestra es porque no se pudieron traer los datos del getProjectById Frontend:",g)}).finally(()=>i(!1))},[r]);const j=(g,b)=>{const u=g.target.files[0];if(u){b("image",u);const y=URL.createObjectURL(u);c(y),h(u.name)}},w=async g=>{try{const b=new FormData;Object.keys(g).forEach(y=>{y==="sections"||(g[y]instanceof File?b.append(y,g[y],g[y].name):b.append(y,g[y]))});const u=await Os(r,b);if(u.ok)R.success("Datos actualizados");else throw new Error(u.message)}catch(b){R.error("Error al editar. Por favor, intenta de nuevo: "+b.message)}};return l?e.jsx("p",{children:"Cargando proyecto..."}):o?e.jsxs(f,{sx:{width:"95%",margin:" 2.5em auto"},children:[e.jsxs(C,{variant:"subtitle1",sx:{marginBottom:"2em",marginTop:"1em",variant:{xs:"subtitle1",md:"h5"}},children:["Editar Proyecto: ",o.projectName," - ",o.constructionType]}),e.jsx(_,{initialValues:t,enableReinitialize:!0,validationSchema:Dt,onSubmit:w,children:({values:g,setFieldValue:b})=>e.jsxs(G,{children:[Object.entries(g).filter(([u])=>!["projectId","filesId","employeeId","userId","reports","sections","area","addedSection","createTask","portal","image"].includes(u)).map(([u])=>e.jsxs(f,{sx:{marginBottom:2},children:[u!=="typeOfWork"&&u!=="constructionType"&&u!=="status"&&u!=="startDate"&&u!=="endDate"&&e.jsx($,{fullWidth:!0,variant:"outlined",label:ie(u),name:u,value:g[u]||"",onChange:y=>b(u,y.target.value)}),u==="typeOfWork"&&e.jsxs(Ce,{fullWidth:!0,variant:"outlined",sx:{marginTop:2},children:[e.jsx(We,{children:ie(u)}),e.jsxs(oe,{name:"typeOfWork",value:g.typeOfWork,onChange:y=>b("typeOfWork",y.target.value),label:ie(u),children:[e.jsx(L,{value:"finishings",children:"Repasos"}),e.jsx(L,{value:"construction",children:"Construcción"}),e.jsx(L,{value:"installations",children:"Instalaciones"}),e.jsx(L,{value:"solarPanels",children:"Paneles solares"}),e.jsx(L,{value:"other",children:"Otras"})]})]}),u==="startDate"&&e.jsx(f,{sx:{marginBottom:2},children:e.jsx($,{fullWidth:!0,variant:"outlined",label:ie(u),name:u,type:"date",value:g[u],onChange:y=>b(u,y.target.value),InputLabelProps:{shrink:!0}})}),u==="endDate"&&e.jsx(f,{sx:{marginBottom:2},children:e.jsx($,{fullWidth:!0,variant:"outlined",label:ie(u),name:u,type:"date",value:g[u],onChange:y=>b(u,y.target.value),InputLabelProps:{shrink:!0}})})]},u)),e.jsxs(f,{sx:{marginTop:2,display:"flex",justifyContent:"center",flexDirection:"column",marginBottom:{xs:"2em",sm:"0"},boxShadow:"0 2px 2px #ccc"},children:[e.jsx(f,{children:n&&e.jsx(Pr,{component:"img",height:"auto",image:n,alt:"Imagen del Proyecto"})}),e.jsxs(T,{variant:"outlined",component:"label",sx:{marginTop:2,marginRight:{xs:0,sm:2},marginBottom:{xs:2,sm:0}},children:["Cambiar Imagen Inicial",e.jsx("input",{type:"file",name:"prevImage",hidden:!0,onChange:u=>j(u,b)})]})]}),e.jsxs(f,{sx:{textAlign:"center",marginTop:3},children:[e.jsx(T,{variant:"outlined",onClick:()=>m("/my-projects"),sx:{marginRight:2,marginLeft:2,":hover":{backgroundColor:"secondary.light"}},children:"Cancelar"}),e.jsx(T,{variant:"contained",type:"submit",sx:{marginLeft:2,backgroundColor:"primary.main",":hover":{backgroundColor:"primary.dark"}},children:"Actualizar"})]})]})})]}):e.jsx("p",{children:"No se encontró el proyecto"})}function Ls(){}const Ms="https://sincro.pro:3001",zs=async r=>{try{const t=localStorage.getItem("token"),a=await fetch(`${Ms}/tasks/${r}`,{method:"GET",headers:{Authorization:`Bearer ${t}`}});if(a.ok)return await a.json();throw new Error("Failed to get task with status: "+a.status)}catch(t){throw console.error("Error al obtener la tarea:",t),t}},Hs="https://sincro.pro:3001",Ws=async(r,t)=>{try{const a=localStorage.getItem("token");if(!(await fetch(`${Hs}/tasks/${r}`,{method:"PATCH",headers:{Authorization:`Bearer ${a}`},body:t})).ok)throw new Error("No se han podido actualizar los cambios en update Task")}catch(a){throw console.error("Error al hacer los cambios:",a),a}};function qs(r){return r.charAt(0).toUpperCase()+r.slice(1)}function Us(){const{taskId:r}=X(),[t,a]=p.useState(null),[o,s]=p.useState(!0),[l,i]=p.useState([]),[d,h]=p.useState([]),[n,c]=p.useState([]),[m,j]=p.useState(Ae());p.useEffect(()=>{(async()=>{try{const u=await zs(r);a(u),h(Array.isArray(u.prevImages)?u.prevImages:[]),c(Array.isArray(u.finalImages)?u.finalImages:[]);const y=await Ie();i(y),j(Ae(u))}catch(u){console.error("Error al obtener la tarea o empleados:",u)}finally{s(!1)}})()},[r]);const w=(b,u,y=[])=>{const x=Array.from(b.target.files);u(y.concat(x))},g=async(b,u)=>{const y=new FormData;Object.keys(b).forEach(x=>{x!=="prevImages"&&x!=="finalImages"&&y.append(x,b[x])}),b.sectionKey||y.append("sectionKey",t.sectionKey),d.forEach(x=>{y.append("prevImages",x)}),n.forEach(x=>{y.append("finalImages",x)});try{await Ws(r,y),R.success("Datos actualizados!")}catch(x){R.error("Error al editar. Por favor, intenta de nuevo."),console.error("Error en el envío del formulario:",x)}finally{u.setSubmitting(!1)}};return o?e.jsx("p",{children:"Cargando..."}):t?e.jsxs(Be,{className:"mt-4",children:[e.jsx("h2",{children:"Editar Tarea"}),e.jsx("h4",{children:qs(t.sectionKey)}),e.jsxs("div",{className:"d-flex align-items-center my-4",children:[e.jsx(Ye,{status:t.status}),e.jsx("h5",{className:"ml-3",children:t.taskName})]}),e.jsx(_,{initialValues:m,validationSchema:Ht,onSubmit:g,enableReinitialize:!0,children:({values:b,handleChange:u,isSubmitting:y})=>e.jsxs(G,{children:[e.jsxs(ee,{children:[e.jsx(U,{xs:12,children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Estado de la tarea"}),e.jsxs(v,{as:"select",name:"status",value:b.status||"",onChange:u,className:"form-control",children:[e.jsx("option",{value:"noIniciado",children:"No Iniciado"}),e.jsx("option",{value:"iniciado",children:"Iniciado"}),e.jsx("option",{value:"terminado",children:"Terminado"})]})]})}),e.jsx(U,{xs:12,children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Trabajador Asignado"}),e.jsx(v,{as:"select",name:"employeeName",value:b.employeeName||"",onChange:u,className:"form-control",children:l.map(x=>e.jsx("option",{value:x.name,children:x.name},x.employeeId))})]})}),e.jsx(U,{xs:12,children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Descripción de la tarea"}),e.jsx(v,{as:"textarea",name:"taskDescription",value:b.taskDescription,onChange:u,className:"form-control"})]})}),e.jsx(U,{xs:6,children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Fecha de inicio"}),e.jsx(v,{as:"input",type:"date",name:"startDate",value:b.startDate,onChange:u,className:"form-control"})]})}),e.jsx(U,{xs:6,children:e.jsxs(W.Group,{children:[e.jsx(W.Label,{children:"Fecha de entrega"}),e.jsx(v,{as:"input",type:"date",name:"endDate",value:b.endDate,onChange:u,className:"form-control"})]})})]}),e.jsxs("div",{className:"border p-3 my-4",children:[e.jsx("h5",{children:"Imágenes iniciales"}),d.length>0&&e.jsx("div",{className:"d-flex flex-wrap mt-2",children:d.map((x,N)=>e.jsx("img",{src:typeof x=="string"?x:URL.createObjectURL(x),alt:`prev-${N}`,className:"mr-2 mb-2",style:{width:"100px",height:"100px"}},N))}),e.jsx("input",{type:"file",name:"prevImages",onChange:x=>w(x,h,d),multiple:!0,className:"form-control mt-3"})]}),e.jsxs("div",{className:"border p-3 my-4",children:[e.jsx("h5",{children:"Imágenes finales"}),n.length>0&&e.jsx("div",{className:"d-flex flex-wrap mt-2",children:n.map((x,N)=>e.jsx("img",{src:typeof x=="string"?x:URL.createObjectURL(x),alt:`final-${N}`,className:"mr-2 mb-2",style:{width:"100px",height:"100px"}},N))}),e.jsx("input",{type:"file",name:"finalImages",onChange:x=>w(x,c,n),multiple:!0,className:"form-control mt-3"})]}),e.jsx("div",{className:"text-center",children:e.jsx(le,{variant:"primary",type:"submit",disabled:y,children:"Guardar Cambios"})})]})})]}):e.jsx("p",{children:"No se encontró la tarea"})}const at={pool:{icon:e.jsx(pt,{}),name:"Piscina"},kitchen:{icon:e.jsx(ht,{}),name:"Cocina"},laundry:{icon:e.jsx(ut,{}),name:"Lavandería"},roof:{icon:e.jsx(xt,{}),name:"Techo"},terrace:{icon:e.jsx(ft,{}),name:"Terraza"},room:{icon:e.jsx(jt,{}),name:"Habitación"},bathRoom:{icon:e.jsx(gt,{}),name:"Baño"},hall:{icon:e.jsx(Me,{}),name:"Pasillo"},livingRoom:{icon:e.jsx(bt,{}),name:"Sala de estar"}},_s="https://sincro.pro:3001",Wt=({project:r,tasks:t,projectId:a})=>{const o=async()=>{const s=new qe,l=50,i=50,d=3,h=(u,y,x)=>y+x>270?(u.addPage(),10):y;s.setFontSize(16),s.setFont("helvetica","bold"),s.setTextColor(255,0,0),s.text("MARVEL CONSTRUCCIONES",10,10),s.setFontSize(12),s.setFont("helvetica","bold"),s.setTextColor(0,0,0),s.text("Datos del Proyecto",10,20),s.setDrawColor(211,211,211),s.line(10,25,200,25);let n=30;if(s.setFont("helvetica","normal"),s.setFontSize(10),s.text(`Nombre del proyecto: ${r.projectName}`,10,n),n+=10,s.text(`Fecha de inicio: ${r.startDate}`,10,n),n+=10,s.text(`Fecha de entrega: ${r.endDate}`,10,n),n+=10,s.text(`Empresa contratante: ${r.hiringCompany}`,10,n),n+=10,s.text(`Descripción general del proyecto: ${r.projectDescription}`,10,n),n+=20,s.setDrawColor(211,211,211),s.line(10,n,200,n),n+=10,!t){console.error("tasks no está definido");return}Object.keys(t).filter(u=>t[u]&&t[u].length>0).forEach(u=>{n=h(s,n,20),s.setFont("helvetica","bold"),s.text(u,10,n),n+=10,t[u].forEach(y=>{if(n=h(s,n,40),s.setFont("helvetica","normal"),s.text(`Tarea: ${y.taskName}`,10,n),n+=10,s.text(`Descripción: ${y.taskDescription}`,10,n),n+=10,s.text(`Fecha de inicio: ${y.startDate}, Fecha de terminación: ${y.endDate}`,10,n),n+=10,y.prevImages&&y.prevImages.length>0){n=h(s,n,i+20),s.text("Imágenes anteriores:",10,n),n+=10;let x=0;y.prevImages.forEach((N,B)=>{B%d===0&&B!==0&&(n+=i+10,x=0,n=h(s,n,i+10)),n+i>270&&(s.addPage(),n=10),s.addImage(N,"JPEG",10+x*(l+10),n,l,i),x++}),n+=i+10}if(y.finalImages&&y.finalImages.length>0){n=h(s,n,i+20),s.text("Imágenes finales:",10,n),n+=10;let x=0;y.finalImages.forEach((N,B)=>{B%d===0&&B!==0&&(n+=i+10,x=0,n=h(s,n,i+10)),n+i>270&&(s.addPage(),n=10),s.addImage(N,"JPEG",10+x*(l+10),n,l,i),x++}),n+=i+10}s.setDrawColor(211,211,211),s.line(10,n,200,n),n+=10,n+=20})});const m=s.output("blob"),j=new Date().toISOString().split("T")[0],w=`reporte_${r.projectName}_${j}.pdf`,g=new File([m],w,{type:m.type}),b=new FormData;b.append("file",g),b.append("projectId",a);for(let u of b.entries())console.log(u[0]+": "+u[1]);try{const u=localStorage.getItem("token"),y=await fetch(`${_s}/projects/${a}/upload-report`,{method:"POST",headers:{Authorization:`Bearer ${u}`},body:b});if(!y.ok)throw new Error(await y.text());const x=await y.json();R.success("Reporte creado exitosamente")}catch(u){console.error("Error subiendo el PDF:",u)}};return e.jsx(T,{variant:"contained",onClick:o,children:"Crear PDF"})};Wt.propTypes={project:k.object,tasks:k.object,fileName:k.string,projectId:k.string.isRequired};function Gs(){const{projectId:r}=X(),[t,a]=p.useState(null),[o,s]=p.useState({}),[l,i]=p.useState(!0),d=z();if(p.useEffect(()=>{r&&ne(r).then(n=>{a(n),i(!1),n.sections.forEach(c=>{_e(r,c).then(m=>{s(j=>({...j,[c]:m}))}).catch(m=>{console.error(`Error fetching tasks for section ${c}:`,m)})})}).catch(n=>{console.error("Error fetching project data:",n),i(!1)})},[r]),l)return e.jsx("p",{children:"Cargando proyecto..."});if(!t)return e.jsx("p",{children:"No se encontró el proyecto"});const h=t.sections.filter(n=>o[n]&&o[n].length>0);return e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"my-4 mt-5",variant:"primary",onClick:()=>d(`/project-info/${r}`),children:"Volver a Tareas"}),e.jsxs(Be,{className:"my-4",style:{maxWidth:"800px"},children:[e.jsx(ee,{className:"mb-3",children:e.jsx(U,{children:e.jsxs("div",{className:"shadow p-4 border rounded mx-auto text-start",style:{maxWidth:"800px"},children:[e.jsx("h5",{children:"Datos del Proyecto"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Nombre del proyecto: "})," ",t.projectName]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Empresa contratante: "})," ",t.hiringCompany]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de inicio: "})," ",t.startDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Fecha de entrega: "})," ",t.endDate]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Descripción general del proyecto: "})," ",t.projectDescription]}),t.image&&e.jsx(Pe,{src:t.image,alt:"Project",fluid:!0})]})})}),e.jsx(ee,{className:"mb-3",children:e.jsx(U,{children:e.jsxs("div",{className:"shadow p-4 border rounded mx-auto text-start ",style:{maxWidth:"800px"},children:[e.jsx("h5",{children:"Dirección"}),e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Dirección:"})," ",t.addressDescription]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Bloque:"})," ",t.block]}),e.jsxs("p",{children:[e.jsx("strong",{children:"No.:"})," ",t.unit]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Código Postal:"})," ",t.zipCode]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Provincia:"})," ",t.province]})]})]})]})})}),h.map(n=>{var c,m;return e.jsx(ee,{className:"mb-4",children:e.jsxs(U,{children:[e.jsxs("h5",{children:[(c=at[n])==null?void 0:c.icon," ",((m=at[n])==null?void 0:m.name)||n]}),o[n]&&o[n].map(j=>e.jsxs("div",{className:"mb-3 shadow p-4 border rounded text-start ",style:{transition:"transform 0.2s",cursor:"pointer"},children:[e.jsx("h6",{children:j.taskName}),e.jsx("p",{children:j.taskDescription}),e.jsxs("p",{children:["Fecha de inicio: ",j.startDate,", Fecha de terminación: ",j.endDate]}),e.jsx(ee,{children:j.prevImages&&j.prevImages.map((w,g)=>e.jsx(U,{xs:12,sm:6,md:4,className:"mb-3 shadow",children:e.jsx(Pe,{src:w,alt:`Prev Image ${g+1}`,fluid:!0})},g))}),e.jsx(ee,{children:j.finalImages&&j.finalImages.map((w,g)=>e.jsx(U,{xs:12,sm:6,md:4,className:"mb-3",children:e.jsx(Pe,{src:w,alt:`Final Image ${g+1}`,fluid:!0})},g))})]},j.taskId))]})},n)})]}),e.jsx(Be,{className:"text-center mt-5 mb-5",children:e.jsx(Wt,{project:t,tasks:o,fileName:`reporte_Proyecto_${t.projectName}.pdf`,projectId:r})})]})}function Ys(){const{sendPasswordResetEmail:r}=Ne(),[t,a]=p.useState(!1),o=Le({initialValues:{email:""},validationSchema:K({email:I().email("Email inválido").required("Requerido")}),onSubmit:async s=>{try{await r(s.email),a(!0)}catch(l){console.error("Error sending reset email:",l)}}});return e.jsxs(f,{sx:{width:"80%",maxWidth:"400px",margin:"2em auto",padding:"2em",boxShadow:3,borderRadius:"20px"},children:[e.jsx(C,{sx:{color:"#1976d2"},mb:3,variant:"h5",children:"Recuperar Contraseña"}),t?e.jsx(C,{sx:{color:"#1976d2"},children:"Un correo ha sido enviado a tu dirección para restablecer tu contraseña."}):e.jsxs("form",{onSubmit:o.handleSubmit,children:[e.jsx($,{type:"email",label:"Ingrese su email",variant:"outlined",fullWidth:!0,value:o.values.email,onChange:o.handleChange("email"),onBlur:o.handleBlur("email"),error:o.touched.email&&!!o.errors.email,helperText:o.touched.email&&o.errors.email,sx:{marginBottom:"1.5em"}}),e.jsx(T,{type:"submit",variant:"contained",sx:{backgroundColor:"#1976d2",padding:"0.5em 2em",borderRadius:"10px","&:hover":{backgroundColor:"#1565c0"}},children:"Enviar"})]})]})}function Vs(){const{auth:r}=Ne();return r?e.jsx(ot,{}):e.jsx(nt,{to:"/login"})}function Ks(){return e.jsx(Et,{children:e.jsx(sa,{children:e.jsxs(Ur,{children:[e.jsx(ce,{}),e.jsxs(it,{children:[e.jsx(F,{path:"/",element:e.jsx(nt,{replace:!0,to:"/login"})}),e.jsx(F,{path:"/login",element:e.jsx(Cs,{})}),e.jsx(F,{path:"/register",element:e.jsx(Es,{})}),e.jsx(F,{path:"/forgot-password",element:e.jsx(Ls,{})}),e.jsx(F,{path:"/reset-password",element:e.jsx(Ys,{})}),e.jsx(F,{element:e.jsx(ys,{}),children:e.jsxs(F,{element:e.jsx(Vs,{}),children:[e.jsx(F,{path:"/home",element:e.jsx(Ds,{})}),e.jsx(F,{path:"/create-new-project",element:e.jsx(Yr,{})}),e.jsx(F,{path:"/my-projects",element:e.jsx(Qr,{})}),e.jsx(F,{path:"/project-info/:projectId",element:e.jsx(ia,{})}),e.jsx(F,{path:"/project-info-data/:projectId",element:e.jsx(Gs,{})}),e.jsx(F,{path:"/project-edit-info/:projectId",element:e.jsx(As,{})}),e.jsx(F,{path:"/project-section-tasks/:projectId/:sectionKey",element:e.jsx(Ps,{})}),e.jsx(F,{path:"/project-create-task/:projectId/:sectionKey",element:e.jsx(Rs,{})}),e.jsx(F,{path:"/edit-task/:taskId",element:e.jsx(Us,{})}),e.jsx(F,{path:"/pendings",element:e.jsx(ga,{})}),e.jsx(F,{path:"/create-order",element:e.jsx(va,{})}),e.jsx(F,{path:"/order-list",element:e.jsx(Sa,{})}),e.jsx(F,{path:"/order-details/:orderId",element:e.jsx(Ta,{})}),e.jsx(F,{path:"/allContacts",element:e.jsx(za,{})}),e.jsx(F,{path:"/create-contact",element:e.jsx(Oa,{})}),e.jsx(F,{path:"/contact-details/:contactId",element:e.jsx(Ya,{})}),e.jsx(F,{path:"/staff-list",element:e.jsx(es,{})}),e.jsx(F,{path:"/create-employee",element:e.jsx(Za,{})}),e.jsx(F,{path:"/employee/:employeeId",element:e.jsx(ps,{})}),e.jsx(F,{path:"/reports",element:e.jsx(js,{})})]})})]})]})})})}Xt.createRoot(document.getElementById("root")).render(e.jsx(Jt.StrictMode,{children:e.jsx(Qt,{children:e.jsx(Et,{children:e.jsx(it,{children:e.jsx(F,{path:"/*",element:e.jsx(Ks,{})})})})})}));
